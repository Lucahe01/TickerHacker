<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UnitedHealth Group (UNH) - TickerHack Deep Research</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F5F5F4; /* stone-100 */
            color: #374151; /* gray-700 */
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 400px;
            max-height: 450px;
        }
        @media (min-width: 768px) { /* md */
            .chart-container {
                height: 450px;
                max-height: 500px;
            }
        }
        .section-card {
            background-color: #FFFFFF;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.07), 0 4px 6px -2px rgba(0, 0, 0, 0.04); /* Softer shadow */
            padding: 1.5rem; /* p-6 */
            margin-bottom: 2rem; /* mb-8 */
        }
        .main-title {
            font-size: 2.25rem; /* text-4xl */
            font-weight: 700; /* font-bold */
            color: #1F2937; /* gray-800 */
            margin-bottom: 1rem;
            text-align: center;
        }
        .section-title {
            font-size: 1.875rem; /* text-3xl */
            font-weight: 600; /* font-semibold */
            color: #A78BFA; /* violet-400 */
            margin-bottom: 1.5rem; /* mb-6 */
            padding-bottom: 0.5rem; /* pb-2 */
            border-bottom: 2px solid #E7E5E4; /* stone-200 */
        }
        .subsection-title {
            font-size: 1.5rem; /* text-2xl */
            font-weight: 600; /* font-semibold */
            color: #7DD3FC; /* sky-400 */
            margin-top: 1.5rem; /* mt-6 */
            margin-bottom: 1rem; /* mb-4 */
        }
        .content-text {
            line-height: 1.75;
            color: #4B5563; /* gray-600 */
            font-size: 0.95rem;
        }
        .highlight {
            color: #F97316; /* orange-500 */
            font-weight: 600;
        }
        .tab-button {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem; /* rounded-md */
            font-weight: 500;
            font-size: 0.875rem; /* text-sm */
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s;
            background-color: #E7E5E4; /* stone-200 */
            color: #374151; /* gray-700 */
            border: 1px solid transparent;
        }
        .tab-button.active {
            background-color: #A78BFA; /* violet-400 */
            color: #FFFFFF;
            border-color: #8B5CF6; /* violet-500 */
        }
        .nav-link {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem; /* rounded-md */
            font-weight: 500;
            color: #374151; /* gray-700 */
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
            white-space: nowrap;
        }
        .nav-link:hover, .nav-link.active {
            background-color: #A78BFA; /* violet-400 */
            color: #FFFFFF;
        }
        .kpi-card {
            background-color: #F9FAFB; /* gray-50 */
            border: 1px solid #E7E5E4; /* stone-200 */
            border-radius: 0.5rem; /* rounded-lg */
            padding: 1rem;
            text-align: center;
        }
        .kpi-label {
            font-size: 0.875rem; /* text-sm */
            color: #6B7280; /* gray-500 */
            margin-bottom: 0.25rem;
        }
        .kpi-value {
            font-size: 1.75rem; /* text-2xl or 3xl */
            font-weight: 600;
            color: #1F2937; /* gray-800 */
        }
    </style>
</head>
<body class="min-h-screen">

    <header class="sticky top-0 z-50 bg-white/95 backdrop-blur-md shadow-md">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex-shrink-0">
                    <h1 class="text-xl font-bold" style="color: #A78BFA;">UnitedHealth Group (UNH) Analysis</h1>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-1 lg:space-x-2">
                        <a href="#overview" class="nav-link">Overview</a>
                        <a href="#segments" class="nav-link">Business Segments</a>
                        <a href="#financials" class="nav-link">Financials</a>
                        <a href="#competition" class="nav-link">Competitive Moat</a>
                        <a href="#outlook" class="nav-link">Outlook</a>
                    </div>
                </div>
                <div class="md:hidden">
                    <button id="mobile-menu-button" type="button" class="inline-flex items-center justify-center p-2 rounded-md text-gray-500 hover:text-gray-700 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-violet-500" aria-controls="mobile-menu" aria-expanded="false">
                        <span class="sr-only">Open main menu</span>
                        <svg class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
                        <svg class="hidden h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
            </div>
            <div class="md:hidden hidden" id="mobile-menu">
                <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                    <a href="#overview" class="nav-link block text-base">Overview</a>
                    <a href="#segments" class="nav-link block text-base">Business Segments</a>
                    <a href="#financials" class="nav-link block text-base">Financials</a>
                    <a href="#competition" class="nav-link block text-base">Competitive Moat</a>
                    <a href="#outlook" class="nav-link block text-base">Outlook</a>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mx-auto p-4 md:p-6 lg:p-8 mt-4">

        <section id="overview" class="section-card scroll-mt-20">
            <h2 class="section-title">A Healthcare Colossus: The UNH Flywheel</h2>
            <p class="content-text mb-6">UnitedHealth Group is a global leader in healthcare, operating two distinct yet complementary businesses: UnitedHealthcare, which provides health insurance and benefits, and Optum, a health services business that leverages technology and data to improve care delivery. This integrated model creates a powerful flywheel, where insights from Optum's services inform UnitedHealthcare's benefit design and cost management, while UnitedHealthcare's vast member base provides a rich data source and distribution channel for Optum. This synergy allows UNH to address the full spectrum of healthcare needs, from coverage to care delivery.</p>

            <div class="grid md:grid-cols-2 gap-6 items-start">
                <div>
                    <h3 class="subsection-title !mt-0">Core Strategy: Integration and Value-Based Care</h3>
                    <p class="content-text mb-4">UNH's strategy revolves around deepening the integration between its two platforms to drive growth and efficiency:</p>
                    <ul class="list-disc list-inside content-text space-y-1 pl-4">
                        <li><strong class="font-semibold text-gray-700">Expanding Value-Based Care:</strong> Shifting from a fee-for-service model to one where providers are compensated based on patient health outcomes, primarily through Optum Health.</li>
                        <li><strong class="font-semibold text-gray-700">Data-Driven Insights:</strong> Utilizing Optum Insight's data analytics to manage medical costs, improve clinical outcomes, and personalize care.</li>
                        <li><strong class="font-semibold text-gray-700">Pharmacy Innovation:</strong> Leveraging Optum Rx to manage prescription drug costs and integrate pharmacy benefits with medical care.</li>
                        <li><strong class="font-semibold text-gray-700">Consumer-Centric Benefits:</strong> Designing simpler, more transparent, and personalized health plans to improve the member experience.</li>
                    </ul>
                </div>
                <div class="kpi-card bg-violet-50 border-violet-200">
                    <p class="kpi-label">Total People Served Globally</p>
                    <p class="kpi-value text-violet-600">>152 Million</p>
                    <p class="content-text text-sm mt-2">The immense scale of its combined businesses gives UNH unparalleled reach and influence across the healthcare ecosystem.</p>
                </div>
            </div>
        </section>

        <section id="segments" class="section-card scroll-mt-20">
            <h2 class="section-title">How UNH Makes Money: Two Sides of the Healthcare Coin</h2>
            <p class="content-text mb-6">UnitedHealth Group's revenue is generated through its two major platforms, UnitedHealthcare and Optum. While UnitedHealthcare's revenue is primarily premium-based, Optum's diverse streams come from care delivery, services, and pharmacy management.</p>

            <div class="mb-6 border-b border-stone-200">
                <nav class="-mb-px flex space-x-4" aria-label="Tabs">
                    <button class="segment-tab-button active" data-target="uhc">UnitedHealthcare</button>
                    <button class="segment-tab-button" data-target="optum">Optum</button>
                </nav>
            </div>

            <div id="segmentDetails">
                <div id="uhcContent" class="segment-content">
                    <h3 class="subsection-title">UnitedHealthcare (~59% of Revenue)</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <p class="content-text mb-2">The health benefits segment generates the majority of its revenue from premiums paid by individuals, employers, and government programs for health insurance coverage. It serves millions of members through its various sub-segments:</p>
                             <ul class="list-disc list-inside content-text space-y-1 pl-4 mt-4">
                                <li><strong>Employer & Individual:</strong> Provides health benefit plans for a wide range of employers and individuals.</li>
                                <li><strong>Medicare & Retirement:</strong> A key growth driver, serving the healthcare needs of the senior population.</li>
                                <li><strong>Community & State:</strong> Manages care for individuals in state-sponsored Medicaid programs.</li>
                             </ul>
                        </div>
                        <div class="kpi-card bg-sky-50 border-sky-200">
                            <p class="kpi-label">Total Consumers Served by UnitedHealthcare (Domestic)</p>
                            <p class="kpi-value text-sky-600">~50.7 Million</p>
                            <p class="content-text text-sm mt-2">A massive membership base provides stable, recurring premium revenue and a rich data source for the enterprise.</p>
                        </div>
                    </div>
                </div>
                <div id="optumContent" class="segment-content hidden">
                    <h3 class="subsection-title">Optum (~41% of Revenue)</h3>
                     <div class="grid grid-cols-1 md:grid-cols-1 gap-6">
                         <div>
                            <p class="content-text mb-2">Optum is the fast-growing health services arm, focused on improving the overall health system. Its revenue is diverse and comes from three main sources:</p>
                             <ul class="list-disc list-inside content-text space-y-1 pl-4 mt-4">
                                <li><strong>Optum Health:</strong> Generates revenue through direct patient care delivery, including primary, specialty, and surgical care, with an emphasis on value-based models.</li>
                                <li><strong>Optum Insight:</strong> Earns revenue from providing data analytics, technology, and managed services to payers, providers, and other healthcare organizations.</li>
                                <li><strong>Optum Rx:</strong> A leading pharmacy benefit manager (PBM) that generates revenue through pharmacy care services, including managing prescription drug benefits and operating specialty pharmacies.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="financials" class="section-card scroll-mt-20">
            <h2 class="section-title">Financial Deep Dive</h2>
            <p class="content-text mb-6">UnitedHealth Group's financial performance showcases its robust growth and the power of its integrated model. The following charts provide a trend analysis of key financial metrics, broken down by its main business segments.</p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div>
                    <h3 class="subsection-title">Fiscal Year Trends (2021-2024)</h3>
                    <div class="mb-4">
                        <label for="yearlyMetricSelect" class="block text-sm font-medium text-gray-700 mb-1">Select Annual Metric:</label>
                        <select id="yearlyMetricSelect" class="block w-full p-2 border border-stone-300 rounded-md shadow-sm focus:ring-violet-500 focus:border-violet-500">
                            <option value="revenue" selected>Total Revenue ($B)</option>
                            <option value="operatingIncome">Operating Income ($B)</option>
                        </select>
                    </div>
                    <div id="yearlyFinancialChartContainer" class="chart-container h-80 max-w-full">
                        <canvas id="yearlyFinancialChart"></canvas>
                    </div>
                </div>

                <div>
                    <h3 class="subsection-title">Quarterly Trends (Recent 9 Qtrs)</h3>
                     <div class="mb-4">
                        <label for="quarterlyMetricSelect" class="block text-sm font-medium text-gray-700 mb-1">Select Quarterly Metric:</label>
                        <select id="quarterlyMetricSelect" class="block w-full p-2 border border-stone-300 rounded-md shadow-sm focus:ring-violet-500 focus:border-violet-500">
                             <option value="revenue" selected>Total Revenue ($B)</option>
                             <option value="operatingIncome">Operating Income ($B)</option>
                        </select>
                    </div>
                    <div id="quarterlyFinancialChartContainer" class="chart-container h-80 max-w-full">
                        <canvas id="quarterlyFinancialChart"></canvas>
                    </div>
                </div>
            </div>
             <p class="content-text text-sm mt-6 text-center">The financial charts highlight consistent top-line growth across both UnitedHealthcare and Optum, with Optum showing a faster growth trajectory. Operating income demonstrates the profitability of this scaled and integrated model.</p>
        </section>

        <section id="competition" class="section-card scroll-mt-20">
            <h2 class="section-title">Competitive Moat: A Fortress of Integration</h2>
            <p class="content-text mb-6">UnitedHealth Group's competitive moat is wide and deep, built on its unparalleled scale, integrated business model, and vast data assets. These factors create significant barriers to entry and make it difficult for competitors to replicate its success.</p>

            <div class="grid md:grid-cols-2 gap-8">
                <div>
                    <h3 class="subsection-title !mt-0">Key Moats</h3>
                    <ul class="list-none space-y-3">
                        <li class="flex items-start">
                            <span class="text-violet-500 mr-2 mt-1">➔</span>
                            <span class="content-text"><strong class="text-gray-700">Scale and Network Effects:</strong> With millions of members and a vast network of providers, UNH benefits from a classic flywheel. More members attract more providers, and a larger network attracts more members.</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-violet-500 mr-2 mt-1">➔</span>
                            <span class="content-text"><strong class="text-gray-700">Integrated Business Model:</strong> The synergy between UnitedHealthcare and Optum allows for cost containment, better care coordination, and a comprehensive view of the patient journey, creating efficiencies that competitors struggle to match.</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-violet-500 mr-2 mt-1">➔</span>
                            <span class="content-text"><strong class="text-gray-700">Data and Technology Advantage:</strong> Optum's data analytics and technology platforms provide a significant competitive edge in pricing risk, managing care, and developing innovative healthcare solutions.</span>
                        </li>
                    </ul>
                </div>
                <div>
                    <h3 class="subsection-title !mt-0">Primary Competitors</h3>
                     <ul class="list-none space-y-3">
                        <li class="flex items-start">
                            <span class="text-sky-500 mr-2 mt-1">●</span>
                            <span class="content-text"><strong class="text-gray-700">Other Large Insurers:</strong> Companies like Elevance Health (formerly Anthem), Cigna, and Humana compete directly with UnitedHealthcare in the health benefits market.</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-sky-500 mr-2 mt-1">●</span>
                            <span class="content-text"><strong class="text-gray-700">PBMs and Care Providers:</strong> Optum competes with other large PBMs like CVS Caremark and Express Scripts, as well as hospital systems and other care delivery organizations.</span>
                        </li>
                         <li class="flex items-start">
                            <span class="text-sky-500 mr-2 mt-1">●</span>
                            <span class="content-text"><strong class="text-gray-700">Tech Disruptors:</strong> Technology giants and well-funded startups are increasingly entering the healthcare space, posing a long-term competitive threat.</span>
                        </li>
                    </ul>
                </div>
            </div>
        </section>

        <section id="outlook" class="section-card scroll-mt-20">
            <h2 class="section-title">Strategic Outlook: Risks & Rewards</h2>
            <p class="content-text mb-6">UnitedHealth Group is well-positioned to capitalize on long-term trends in healthcare, but it must also navigate a complex and evolving landscape of risks and challenges.</p>
            <div class="grid md:grid-cols-2 gap-8">
                <div>
                    <h3 class="subsection-title !mt-0 text-teal-600">Rewards & Opportunities 🚀</h3>
                    <ul class="list-disc list-inside content-text space-y-2 pl-4">
                        <li><strong>Aging Population:</strong> The growing number of seniors in the U.S. provides a long-term tailwind for the Medicare Advantage business.</li>
                        <li><strong>Shift to Value-Based Care:</strong> UNH is a leader in the transition to value-based care, which has the potential to improve outcomes and lower costs, driving long-term value.</li>
                        <li><strong>Growth of Optum:</strong> The high-growth, high-margin Optum segments continue to expand, diversifying revenue streams and enhancing the overall enterprise.</li>
                        <li><strong>Technological Innovation:</strong> Continued investment in AI and data analytics can further enhance efficiency, personalize care, and create new growth opportunities.</li>
                    </ul>
                </div>
                <div>
                    <h3 class="subsection-title !mt-0 text-orange-600">Risks & Challenges 📉</h3>
                    <ul class="list-disc list-inside content-text space-y-2 pl-4">
                        <li><strong>Cybersecurity Vulnerabilities:</strong> The Change Healthcare cyberattack highlighted the significant financial and reputational risks associated with protecting vast amounts of sensitive health data.</li>
                        <li><strong>Regulatory Headwinds:</strong> Increased scrutiny of the healthcare industry, including potential changes to Medicare Advantage reimbursement rates and regulations around PBMs, could pressure margins.</li>
                        <li><strong>Rising Medical Costs:</strong> Unexpected increases in healthcare utilization and costs can negatively impact profitability, as seen with recent trends in the Medicare Advantage population.</li>
                        <li><strong>Execution Risk:</strong> The complexity of managing such a large and diverse organization presents ongoing execution risks, particularly in integrating new acquisitions and managing the response to major crises.</li>
                    </ul>
                </div>
            </div>
        </section>

        <footer class="bg-stone-800 text-stone-300 py-8 text-center mt-12">
            <p class="text-sm">&copy; <span id="currentYearFooter"></span> TickerHack Deep Research. For informational purposes only.</p>
            <p class="text-xs mt-1">Data synthesized from UnitedHealth Group public filings (SEC 10-K & 10-Q reports) and credible financial data providers as of July 2025.</p>
        </footer>

    <script>
        document.getElementById('currentYearFooter').textContent = new Date().getFullYear();

        // Mobile menu toggle
        const mobileMenuBtn = document.getElementById('mobile-menu-button');
        const mobileMenuEl = document.getElementById('mobile-menu');
        mobileMenuBtn.addEventListener('click', () => {
            mobileMenuEl.classList.toggle('hidden');
            mobileMenuBtn.querySelectorAll('svg').forEach(svg => svg.classList.toggle('hidden'));
        });
        
        // Smooth scroll and active nav link highlighting
        const navLinks = document.querySelectorAll('header nav a[href^="#"]');
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                if (mobileMenuEl && !mobileMenuEl.classList.contains('hidden')) {
                    mobileMenuBtn.click(); // Close mobile menu if open
                }
                navLinks.forEach(l => l.classList.remove('active'));
                e.currentTarget.classList.add('active');
            });
        });
        
        // Segment Tabs
        const segmentTabs = document.querySelectorAll('.segment-tab-button');
        const segmentContents = document.querySelectorAll('.segment-content');
        segmentTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                segmentTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                const targetId = tab.dataset.target + 'Content';
                segmentContents.forEach(content => {
                    content.id === targetId ? content.classList.remove('hidden') : content.classList.add('hidden');
                });
            });
        });

        // Chart.js Global Config
        Chart.defaults.font.family = "'Inter', sans-serif"; // <-- CORRECTED THIS LINE
        Chart.defaults.color = '#4B5563';

        const CHART_COLORS = {
            violet: '#A78BFA',
            sky: '#7DD3FC',
            orange: '#FDBA74',
            teal: '#5EEAD4',
            pink: '#F472B6',
            amber: '#FBBF24'
        };

        // --- FINANCIAL CHARTS LOGIC ---

        const yearlyDataStore = {
            labels: ['2021', '2022', '2023', '2024'],
            revenue: {
                datasets: [
                    { label: 'UnitedHealthcare Revenue ($B)', data: [226.2, 249.7, 281.4, 298.2], backgroundColor: CHART_COLORS.violet + 'BF', borderColor: CHART_COLORS.violet, stack: 'Stack 0' },
                    { label: 'Optum Health Revenue ($B)', data: [53.9, 69.8, 91.3, 105.4], backgroundColor: CHART_COLORS.sky + 'BF', borderColor: CHART_COLORS.sky, stack: 'Stack 1' },
                    { label: 'Optum Insight Revenue ($B)', data: [12.2, 14.6, 18.9, 18.8], backgroundColor: CHART_COLORS.orange + 'BF', borderColor: CHART_COLORS.orange, stack: 'Stack 1' },
                    { label: 'Optum Rx Revenue ($B)', data: [91.3, 98.4, 116.4, 128.8], backgroundColor: CHART_COLORS.teal + 'BF', borderColor: CHART_COLORS.teal, stack: 'Stack 1' }
                ]
            },
            operatingIncome: {
                datasets: [
                    { label: 'UnitedHealthcare Op. Income ($B)', data: [12.0, 14.4, 16.4, 15.6], backgroundColor: CHART_COLORS.violet + 'BF', borderColor: CHART_COLORS.violet, stack: 'Stack 0' },
                    { label: 'Optum Op. Income ($B)', data: [11.9, 14.0, 15.9, 16.7], backgroundColor: CHART_COLORS.sky + 'BF', borderColor: CHART_COLORS.sky, stack: 'Stack 1' }
                ]
            }
        };

        const quarterlyDataStore = {
            labels: ['Q1 23', 'Q2 23', 'Q3 23', 'Q4 23', 'Q1 24', 'Q2 24', 'Q3 24', 'Q4 24', 'Q1 25'],
            revenue: {
                datasets: [
                    { label: 'UnitedHealthcare Revenue ($B)', data: [70.5, 70.2, 70.0, 70.8, 75.4, 73.9, 74.8, 74.1, 84.6], backgroundColor: CHART_COLORS.violet + 'BF', borderColor: CHART_COLORS.violet, stack: 'Stack 0' },
                    { label: 'Optum Revenue ($B)', data: [54.1, 56.3, 56.7, 59.5, 61.1, 62.9, 64.0, 65.1, 63.9], backgroundColor: CHART_COLORS.sky + 'BF', borderColor: CHART_COLORS.sky, stack: 'Stack 1' }
                ]
            },
            operatingIncome: {
                datasets: [
                    { label: 'UnitedHealthcare Op. Income ($B)', data: [3.9, 4.7, 4.7, 3.1, 4.4, 4.1, 4.1, 3.0, 5.2], backgroundColor: CHART_COLORS.violet + 'BF', borderColor: CHART_COLORS.violet, stack: 'Stack 0' },
                    { label: 'Optum Op. Income ($B)', data: [4.3, 3.7, 3.9, 4.6, 3.5, 4.2, 4.4, 4.8, 3.9], backgroundColor: CHART_COLORS.sky + 'BF', borderColor: CHART_COLORS.sky, stack: 'Stack 1' }
                ]
            }
        };

        let yearlyChart = null;
        let quarterlyChart = null;
        const yearlySelect = document.getElementById('yearlyMetricSelect');
        const quarterlySelect = document.getElementById('quarterlyMetricSelect');
        const yearlyCanvas = document.getElementById('yearlyFinancialChart').getContext('2d');
        const quarterlyCanvas = document.getElementById('quarterlyFinancialChart').getContext('2d');

        function createChart(canvas, existingChart, dataStore, metricKey) {
            if (existingChart) {
                existingChart.destroy();
            }
            const metricDetails = dataStore[metricKey];

            return new Chart(canvas, {
                type: 'bar',
                data: {
                    labels: dataStore.labels,
                    datasets: metricDetails.datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(context.parsed.y) + 'B';
                                    }
                                    return label;
                                }
                            }
                        },
                        legend: {
                            position: 'bottom',
                        }
                    },
                    scales: {
                        x: {
                            stacked: true,
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Billions of USD'
                            },
                            ticks: {
                                callback: function(value) {
                                    return '$' + value + 'B';
                                }
                            }
                        }
                    }
                }
            });
        }

        yearlySelect.addEventListener('change', (event) => {
            yearlyChart = createChart(yearlyCanvas, yearlyChart, yearlyDataStore, event.target.value);
        });

        quarterlySelect.addEventListener('change', (event) => {
            quarterlyChart = createChart(quarterlyCanvas, quarterlyChart, quarterlyDataStore, event.target.value);
        });

        // Initial chart renders
        yearlyChart = createChart(yearlyCanvas, yearlyChart, yearlyDataStore, 'revenue');
        quarterlyChart = createChart(quarterlyCanvas, quarterlyChart, quarterlyDataStore, 'revenue');

    </script>
</body>
</html>

