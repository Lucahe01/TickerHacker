<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Viatris (VTRS) - TickerHack Deep Research</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F5F5F4; /* stone-100 */
            color: #374151; /* gray-700 */
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 350px;
        }
        @media (min-width: 768px) { /* md */
            .chart-container {
                height: 350px;
                max-height: 400px;
            }
        }
        .section-card {
            background-color: #FFFFFF;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.07), 0 4px 6px -2px rgba(0, 0, 0, 0.04); /* Softer shadow */
            padding: 1.5rem; /* p-6 */
            margin-bottom: 2rem; /* mb-8 */
        }
        .main-title {
            font-size: 2.25rem; /* text-4xl */
            font-weight: 700; /* font-bold */
            color: #1F2937; /* gray-800 */
            margin-bottom: 1rem;
            text-align: center;
        }
        .section-title {
            font-size: 1.875rem; /* text-3xl */
            font-weight: 600; /* font-semibold */
            color: #A78BFA; /* violet-400 */
            margin-bottom: 1.5rem; /* mb-6 */
            padding-bottom: 0.5rem; /* pb-2 */
            border-bottom: 2px solid #E7E5E4; /* stone-200 */
        }
        .subsection-title {
            font-size: 1.5rem; /* text-2xl */
            font-weight: 600; /* font-semibold */
            color: #7DD3FC; /* sky-400 */
            margin-top: 1.5rem; /* mt-6 */
            margin-bottom: 1rem; /* mb-4 */
        }
        .content-text {
            line-height: 1.75;
            color: #4B5563; /* gray-600 */
            font-size: 0.95rem;
        }
        .highlight {
            color: #F97316; /* orange-500 */
            font-weight: 600;
        }
        .tab-button {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem; /* rounded-md */
            font-weight: 500;
            font-size: 0.875rem; /* text-sm */
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s;
            background-color: #E7E5E4; /* stone-200 */
            color: #374151; /* gray-700 */
            border: 1px solid transparent;
        }
        .tab-button.active {
            background-color: #A78BFA; /* violet-400 */
            color: #FFFFFF;
            border-color: #8B5CF6; /* violet-500 */
        }
        .nav-link {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem; /* rounded-md */
            font-weight: 500;
            color: #374151; /* gray-700 */
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
            white-space: nowrap;
        }
        .nav-link:hover, .nav-link.active {
            background-color: #A78BFA; /* violet-400 */
            color: #FFFFFF;
        }
        .kpi-card {
            background-color: #F9FAFB; /* gray-50 */
            border: 1px solid #E7E5E4; /* stone-200 */
            border-radius: 0.5rem; /* rounded-lg */
            padding: 1rem;
            text-align: center;
        }
        .kpi-label {
            font-size: 0.875rem; /* text-sm */
            color: #6B7280; /* gray-500 */
            margin-bottom: 0.25rem;
        }
        .kpi-value {
            font-size: 1.75rem; /* text-2xl or 3xl */
            font-weight: 600;
            color: #1F2937; /* gray-800 */
        }
    </style>
</head>
<body class="min-h-screen">

    <header class="sticky top-0 z-50 bg-white/95 backdrop-blur-md shadow-md">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex-shrink-0">
                    <h1 class="text-xl font-bold" style="color: #A78BFA;">Viatris (VTRS) Analysis</h1>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-1 lg:space-x-2">
                        <a href="#overview" class="nav-link">Overview</a>
                        <a href="#segments" class="nav-link">Business Segments</a>
                        <a href="#financials" class="nav-link">Financials</a>
                        <a href="#competition" class="nav-link">Competitive Moat</a>
                        <a href="#outlook" class="nav-link">Outlook</a>
                    </div>
                </div>
                <div class="md:hidden">
                    <button id="mobile-menu-button" type="button" class="inline-flex items-center justify-center p-2 rounded-md text-gray-500 hover:text-gray-700 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-violet-500" aria-controls="mobile-menu" aria-expanded="false">
                        <span class="sr-only">Open main menu</span>
                        <svg class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
                        <svg class="hidden h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
            </div>
            <div class="md-hidden hidden" id="mobile-menu">
                <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                    <a href="#overview" class="nav-link block text-base">Overview</a>
                    <a href="#segments" class="nav-link block text-base">Business Segments</a>
                    <a href="#financials" class="nav-link block text-base">Financials</a>
                    <a href="#competition" class="nav-link block text-base">Competitive Moat</a>
                    <a href="#outlook" class="nav-link block text-base">Outlook</a>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mx-auto p-4 md:p-6 lg:p-8 mt-4">

        <section id="overview" class="section-card scroll-mt-20">
            <h2 class="section-title">Viatris: A Global Healthcare Giant in Transition</h2>
            <p class="content-text mb-6">Viatris is a global healthcare company formed through the combination of Mylan and Pfizer's Upjohn business, creating a leader in generics, biosimilars, and off-patent branded drugs. The company's core mission is to provide broad access to affordable medicines. However, facing industry-wide pricing pressures, Viatris is undergoing a significant strategic transformation. It is divesting non-core assets to pay down debt and simplify its structure, with a future focus on two key therapeutic areas: <span class="highlight">ophthalmology and dermatology</span>. This analysis explores the current state of Viatris's business, its financial foundation, and the risks and rewards of its strategic pivot.</p>
            
            <div class="grid md:grid-cols-2 gap-6 items-start">
                <div>
                    <h3 class="subsection-title !mt-0">Core Strategy: A Two-Phase Transformation</h3>
                    <p class="content-text mb-4">Viatris is executing a clear plan to reshape the company:</p>
                    <ul class="list-disc list-inside content-text space-y-1 pl-4">
                        <li><strong class="font-semibold text-gray-700">Phase 1 (Current):</strong> Divest non-core businesses (OTC, Women's Health, API) to generate ~$6B in proceeds. Use this capital to de-lever the balance sheet and return capital to shareholders.</li>
                        <li><strong class="font-semibold text-gray-700">Phase 2 (Future):</strong> Build upon a stable base of core products and invest the company's strong free cash flow into building a pipeline in ophthalmology and dermatology through internal R&D and business development.</li>
                        <li><strong class="font-semibold text-gray-700">Capital Allocation:</strong> Committed to a strong dividend and a plan to return at least 50% of free cash flow to shareholders through dividends and share buybacks.</li>
                    </ul>
                </div>
                <div class="kpi-card bg-violet-50 border-violet-200">
                    <p class="kpi-label">Annual Free Cash Flow Target</p>
                    <p class="kpi-value text-violet-600">~$2.5 Billion</p>
                    <p class="content-text text-sm mt-2">The company's ability to consistently generate strong free cash flow is the financial bedrock of its strategy, funding both the dividend and future investments.</p>
                </div>
            </div>
        </section>

        <section id="segments" class="section-card scroll-mt-20">
            <h2 class="section-title">How Viatris Makes Money: A Diversified Portfolio</h2>
            <p class="content-text mb-6">Viatris's revenue is generated across a broad spectrum of products, from well-known brands that have lost patent exclusivity to a vast portfolio of generic drugs.</p>

            <div class="mb-6 border-b border-stone-200">
                <nav class="-mb-px flex space-x-4" aria-label="Tabs">
                    <button class="segment-tab-button active" data-target="brands">Brands</button>
                    <button class="segment-tab-button" data-target="generics">Generics</button>
                    <button class="segment-tab-button" data-target="complex">Complex & Biosimilars</button>
                </nav>
            </div>

            <div id="segmentDetails">
                <div id="brandsContent" class="segment-content">
                    <h3 class="subsection-title">Brands Segment</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <p class="content-text mb-2">This segment consists of legacy, off-patent drugs that maintain strong brand recognition and continue to generate significant sales. These products provide stable cash flow for the company.</p>
                             <ul class="list-disc list-inside content-text space-y-1 pl-4 mt-4">
                                <li><strong>Key Products:</strong> Lipitor (cholesterol), Norvasc (hypertension), Viagra (erectile dysfunction), and Lyrica (nerve pain).</li>
                             </ul>
                        </div>
                        <div class="kpi-card bg-sky-50 border-sky-200">
                            <p class="kpi-label">Brands Revenue (2024)</p>
                            <p class="kpi-value text-sky-600">$5.6 Billion</p>
                            <p class="content-text text-sm mt-2">These trusted, iconic brands are a durable and highly profitable source of revenue for Viatris.</p>
                        </div>
                    </div>
                </div>
                <div id="genericsContent" class="segment-content hidden">
                    <h3 class="subsection-title">Generics Segment</h3>
                     <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                         <div>
                            <p class="content-text mb-2">This segment includes a wide variety of traditional generic drugs, such as tablets and capsules. It is the company's largest segment by volume and leverages Viatris's massive global manufacturing and commercial scale. However, it is also the segment most exposed to intense competition and pricing pressure.</p>
                        </div>
                         <div class="kpi-card bg-teal-50 border-teal-200">
                             <p class="kpi-label">Generics Revenue (2024)</p>
                             <p class="kpi-value text-teal-600">$6.0 Billion</p>
                             <p class="content-text text-sm mt-2">The backbone of the company's mission to provide affordable access to medicine worldwide.</p>
                         </div>
                    </div>
                </div>
                 <div id="complexContent" class="segment-content hidden">
                    <h3 class="subsection-title">Complex Gx & Biosimilars Segment</h3>
                     <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                         <div>
                            <p class="content-text mb-2">This segment includes more difficult-to-develop and manufacture products, which typically have fewer competitors and better pricing stability than traditional generics. This is a key area of focus for Viatris.</p>
                             <ul class="list-disc list-inside content-text space-y-1 pl-4 mt-4">
                                <li><strong>Key Products:</strong> Wixela Inhub (generic Advair®), Glatiramer Acetate (generic Copaxone®), and Semglee® (biosimilar to Lantus®).</li>
                             </ul>
                        </div>
                         <div class="kpi-card bg-orange-50 border-orange-200">
                             <p class="kpi-label">Complex Gx Revenue (2024)</p>
                             <p class="kpi-value text-orange-600">$1.3 Billion</p>
                             <p class="content-text text-sm mt-2">A higher-margin segment that leverages the company's advanced scientific and manufacturing capabilities.</p>
                         </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="financials" class="section-card scroll-mt-20">
            <h2 class="section-title">Financial Deep Dive</h2>
            <p class="content-text mb-6">Viatris's financial story is defined by its massive scale and its ability to generate strong, predictable free cash flow. While reported revenues have declined due to pricing pressure and divestitures, the underlying cash generation of the business remains a core strength.</p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div>
                    <h3 class="subsection-title">Fiscal Year Trends (FY22-FY24)</h3>
                    <div class="mb-4">
                        <label for="yearlyMetricSelect" class="block text-sm font-medium text-gray-700 mb-1">Select Annual Metric:</label>
                        <select id="yearlyMetricSelect" class="block w-full p-2 border border-stone-300 rounded-md shadow-sm focus:ring-violet-500 focus:border-violet-500">
                            <option value="totalRevenue" selected>Revenue by Segment ($B)</option>
                            <option value="freeCashFlow">Free Cash Flow ($B)</option>
                        </select>
                    </div>
                    <div id="yearlyFinancialChartContainer" class="chart-container h-80 max-w-full">
                        <canvas id="yearlyFinancialChart"></canvas>
                    </div>
                </div>

                <div>
                    <h3 class="subsection-title">Quarterly Trends (Recent 8 Qtrs)</h3>
                     <div class="mb-4">
                        <label for="quarterlyMetricSelect" class="block text-sm font-medium text-gray-700 mb-1">Select Quarterly Metric:</label>
                        <select id="quarterlyMetricSelect" class="block w-full p-2 border border-stone-300 rounded-md shadow-sm focus:ring-violet-500 focus:border-violet-500">
                             <option value="totalRevenue" selected>Total Revenue ($B)</option>
                             <option value="freeCashFlow">Free Cash Flow ($M)</option>
                        </select>
                    </div>
                    <div id="quarterlyFinancialChartContainer" class="chart-container h-80 max-w-full">
                        <canvas id="quarterlyFinancialChart"></canvas>
                    </div>
                </div>
            </div>
             <p class="content-text text-sm mt-6 text-center">The financial charts illustrate the stability of the company's different business lines and its consistent ability to generate substantial free cash flow.</p>
        </section>

        <section id="competition" class="section-card scroll-mt-20">
            <h2 class="section-title">Competitive Moat: The Power of Scale and Diversity</h2>
            <p class="content-text mb-6">Viatris's competitive advantages are derived from its massive scale, global reach, and diversified portfolio, which are difficult for smaller competitors to replicate.</p>
            
            <div class="grid md:grid-cols-2 gap-8">
                <div>
                    <h3 class="subsection-title !mt-0">Key Moats</h3>
                    <ul class="list-none space-y-3">
                        <li class="flex items-start">
                            <span class="text-violet-500 mr-2 mt-1">➔</span>
                            <span class="content-text"><strong class="text-gray-700">Global Infrastructure:</strong> The company's vast manufacturing, regulatory, and commercial infrastructure allows it to efficiently produce and market products on a global scale.</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-violet-500 mr-2 mt-1">➔</span>
                            <span class="content-text"><strong class="text-gray-700">Portfolio Breadth:</strong> With thousands of marketed products, the company is highly diversified, which provides stability even as individual products face competition.</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-violet-500 mr-2 mt-1">➔</span>
                            <span class="content-text"><strong class="text-gray-700">Durable Brands:</strong> Iconic brands like Lipitor and Viagra provide a stable and high-margin source of cash flow that helps fund the rest of the business.</span>
                        </li>
                    </ul>
                </div>
                <div>
                    <h3 class="subsection-title !mt-0">Primary Competitors</h3>
                     <ul class="list-none space-y-3">
                        <li class="flex items-start">
                            <span class="text-sky-500 mr-2 mt-1">●</span>
                            <span class="content-text"><strong class="text-gray-700">Teva Pharmaceutical (TEVA):</strong> A major global competitor in both the generics and specialty pharmaceuticals markets.</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-sky-500 mr-2 mt-1">●</span>
                            <span class="content-text"><strong class="text-gray-700">Sandoz (a Novartis division):</strong> Another large global player in the generics and biosimilars space.</span>
                        </li>
                         <li class="flex items-start">
                            <span class="text-sky-500 mr-2 mt-1">●</span>
                            <span class="content-text"><strong class="text-gray-700">Numerous Regional Players:</strong> The generics market is highly fragmented, and Viatris competes with many smaller, regional manufacturers in various markets around the world.</span>
                        </li>
                    </ul>
                </div>
            </div>
        </section>

        <section id="outlook" class="section-card scroll-mt-20">
            <h2 class="section-title">Strategic Outlook: Risks & Rewards</h2>
            <p class="content-text mb-6">Viatris is a company at a crossroads, attempting to shed its legacy identity and forge a new path toward focused growth. The potential rewards for shareholders are significant if the plan succeeds, but the risks of this transformation are equally substantial.</p>
            <div class="grid md:grid-cols-2 gap-8">
                <div>
                    <h3 class="subsection-title !mt-0 text-teal-600">Rewards & Opportunities 🚀</h3>
                    <ul class="list-disc list-inside content-text space-y-2 pl-4">
                        <li><strong>Successful Transformation:</strong> If Viatris successfully executes its divestitures and builds a successful pipeline in its new focus areas, it could unlock significant shareholder value.</li>
                        <li><strong>Strong Shareholder Returns:</strong> The company's commitment to returning over 50% of its substantial free cash flow provides an attractive dividend and the potential for share buybacks.</li>
                        <li><strong>De-leveraging Story:</strong> The use of divestiture proceeds to pay down debt will strengthen the balance sheet and reduce financial risk.</li>
                        <li><strong>Stable Cash Flow:</strong> The underlying business continues to be a cash-generating machine, providing a solid foundation for the company's strategic plans.</li>
                    </ul>
                </div>
                <div>
                    <h3 class="subsection-title !mt-0 text-orange-600">Risks & Challenges 📉</h3>
                    <ul class="list-disc list-inside content-text space-y-2 pl-4">
                        <li><strong>Execution Risk:</strong> The plan to sell off multiple large businesses is highly complex and carries the risk of delays, disruptions, or failing to achieve expected valuations.</li>
                        <li><strong>Pricing Pressure:</strong> The core generics business faces relentless pricing pressure from competitors, which could continue to erode revenue and margins.</li>
                        <li><strong>Pipeline Failure:</strong> There is no guarantee that the company's investments in ophthalmology and dermatology will result in successful new products. Pipeline development is a high-risk endeavor.</li>
                        <li><strong>Loss of Diversification:</strong> While simplifying the business, the divestitures also reduce the company's diversification, potentially making it more vulnerable to challenges in its remaining core markets.</li>
                    </ul>
                </div>
            </div>
        </section>

        <footer class="bg-stone-800 text-stone-300 py-8 text-center mt-12">
            <p class="text-sm">&copy; <span id="currentYearFooter"></span> TickerHack Deep Research. For informational purposes only.</p>
            <p class="text-xs mt-1">Data synthesized from Viatris Inc. public filings and credible financial data providers as of July 2, 2025.</p>
        </footer>

    <script>
        document.getElementById('currentYearFooter').textContent = new Date().getFullYear();

        // Mobile menu toggle
        const mobileMenuBtn = document.getElementById('mobile-menu-button');
        const mobileMenuEl = document.getElementById('mobile-menu');
        mobileMenuBtn.addEventListener('click', () => {
            mobileMenuEl.classList.toggle('hidden');
            mobileMenuBtn.querySelectorAll('svg').forEach(svg => svg.classList.toggle('hidden'));
        });
        
        // Smooth scroll and active nav link highlighting
        const navLinks = document.querySelectorAll('header nav a[href^="#"]');
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                if (mobileMenuEl && !mobileMenuEl.classList.contains('hidden')) {
                    mobileMenuBtn.click(); // Close mobile menu if open
                }
                navLinks.forEach(l => l.classList.remove('active'));
                e.currentTarget.classList.add('active');
            });
        });
        
        // Segment Tabs
        const segmentTabs = document.querySelectorAll('.segment-tab-button');
        const segmentContents = document.querySelectorAll('.segment-content');
        segmentTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                segmentTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                const targetId = tab.dataset.target + 'Content';
                segmentContents.forEach(content => {
                    content.id === targetId ? content.classList.remove('hidden') : content.classList.add('hidden');
                });
            });
        });

        // Chart.js Global Config
        Chart.defaults.font.family = "'Inter', sans-serif";
        Chart.defaults.color = '#4B5563';

        const CHART_COLORS = {
            violet: '#A78BFA',
            sky: '#7DD3FC',
            orange: '#FDBA74',
            teal: '#5EEAD4'
        };
        

        // --- FINANCIAL CHARTS LOGIC ---

        const yearlyDataStore = {
            labels: ['FY22', 'FY23', 'FY24'],
            totalRevenue: {
                datasets: [
                    { label: 'Brands Revenue ($B)', data: [6.7, 5.9, 5.6], backgroundColor: CHART_COLORS.violet + 'BF', borderColor: CHART_COLORS.violet, stack: 'Stack 0' },
                    { label: 'Generics Revenue ($B)', data: [7.5, 6.2, 6.0], backgroundColor: CHART_COLORS.sky + 'BF', borderColor: CHART_COLORS.sky, stack: 'Stack 0' },
                    { label: 'Complex Gx & Biosimilars ($B)', data: [1.4, 1.3, 1.3], backgroundColor: CHART_COLORS.orange + 'BF', borderColor: CHART_COLORS.orange, stack: 'Stack 0' }
                ]
            },
            freeCashFlow: {
                datasets: [
                    { label: 'Free Cash Flow ($B)', data: [2.6, 2.4, 2.5], backgroundColor: CHART_COLORS.teal + 'BF', borderColor: CHART_COLORS.teal }
                ]
            }
        };

        const quarterlyDataStore = {
            labels: ['Q2 23', 'Q3 23', 'Q4 23', 'Q1 24', 'Q2 24', 'Q3 24', 'Q4 24', 'Q1 25'],
            totalRevenue: {
                datasets: [
                    { label: 'Brands Revenue ($B)', data: [1.5, 1.4, 1.4, 1.4, 1.3, 1.3, 1.3, 1.3], backgroundColor: CHART_COLORS.violet + 'BF', borderColor: CHART_COLORS.violet, stack: 'Stack 0' },
                    { label: 'Generics Revenue ($B)', data: [1.6, 1.5, 1.5, 1.5, 1.4, 1.4, 1.4, 1.4], backgroundColor: CHART_COLORS.sky + 'BF', borderColor: CHART_COLORS.sky, stack: 'Stack 0' },
                    { label: 'Complex Gx & Biosimilars ($B)', data: [0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3], backgroundColor: CHART_COLORS.orange + 'BF', borderColor: CHART_COLORS.orange, stack: 'Stack 0' }
                ]
            },
            freeCashFlow: {
                datasets: [
                    { label: 'Free Cash Flow ($M)', data: [700, 650, 600, 600, 650, 600, 550, 550], backgroundColor: CHART_COLORS.teal + 'BF', borderColor: CHART_COLORS.teal }
                ]
            }
        };

        let yearlyChart = null;
        let quarterlyChart = null;
        const yearlySelect = document.getElementById('yearlyMetricSelect');
        const quarterlySelect = document.getElementById('quarterlyMetricSelect');
        const yearlyCanvas = document.getElementById('yearlyFinancialChart').getContext('2d');
        const quarterlyCanvas = document.getElementById('quarterlyFinancialChart').getContext('2d');

        function createChart(canvas, existingChart, dataStore, metricKey) {
            if (existingChart) {
                existingChart.destroy();
            }
            const metricDetails = dataStore[metricKey];
            const isStacked = metricKey === 'totalRevenue';

            return new Chart(canvas, {
                type: 'bar',
                data: {
                    labels: dataStore.labels,
                    datasets: metricDetails.datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        let val = context.parsed.y;
                                        let unit = label.includes('($B)') ? 'B' : (label.includes('($M)') ? 'M' : '');
                                        label += '$' + val.toFixed(1) + unit;
                                    }
                                    return label;
                                }
                            }
                        },
                        legend: {
                            position: 'bottom',
                        }
                    },
                    scales: {
                        x: {
                            stacked: isStacked,
                        },
                        y: {
                            stacked: isStacked,
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Billions of USD'
                            },
                            ticks: {
                                callback: function(value) {
                                    let unit = metricDetails.datasets[0].label.includes('($B)') ? 'B' : 'M';
                                    return '$' + value + unit;
                                }
                            }
                        }
                    }
                }
            });
        }

        function createFcfChart(canvas, existingChart, dataStore, metricKey) {
            if (existingChart) {
                existingChart.destroy();
            }
            const metricDetails = dataStore[metricKey];

            return new Chart(canvas, {
                type: 'bar',
                data: {
                    labels: dataStore.labels,
                    datasets: metricDetails.datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                         legend: { display: false },
                         tooltip: {
                             callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        let val = context.parsed.y;
                                        let unit = label.includes('($B)') ? 'B' : (label.includes('($M)') ? 'M' : '');
                                        label += '$' + val + unit;
                                    }
                                    return label;
                                }
                            }
                         }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: metricKey === 'yearly' ? 'Billions of USD' : 'Millions of USD'
                            },
                            ticks: {
                                callback: function(value) {
                                    let unit = metricKey === 'yearly' ? 'B' : 'M';
                                    return '$' + value + unit;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        yearlySelect.addEventListener('change', (event) => {
             if (event.target.value === 'freeCashFlow') {
                 yearlyChart = createFcfChart(yearlyCanvas, yearlyChart, yearlyDataStore, 'yearly');
             } else {
                 yearlyChart = createChart(yearlyCanvas, yearlyChart, yearlyDataStore, 'totalRevenue');
             }
        });

        quarterlySelect.addEventListener('change', (event) => {
            if (event.target.value === 'freeCashFlow') {
                 quarterlyChart = createFcfChart(quarterlyCanvas, quarterlyChart, quarterlyDataStore, 'quarterly');
             } else {
                 quarterlyChart = createChart(quarterlyCanvas, quarterlyChart, quarterlyDataStore, 'totalRevenue');
             }
        });

        // Initial chart renders
        yearlyChart = createChart(yearlyCanvas, yearlyChart, yearlyDataStore, 'totalRevenue');
        quarterlyChart = createChart(quarterlyCanvas, quarterlyChart, quarterlyDataStore, 'totalRevenue');

    </script>
</body>
</html>

