<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IDEXX Laboratories, Inc. (IDXX) - TickerHack Deep Research</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F5F5F4; /* stone-100 */
            color: #374151; /* gray-700 */
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 350px;
        }
        @media (min-width: 768px) { /* md */
            .chart-container {
                height: 350px;
                max-height: 400px;
            }
        }
        .section-card {
            background-color: #FFFFFF;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.07), 0 4px 6px -2px rgba(0, 0, 0, 0.04); /* Softer shadow */
            padding: 1.5rem; /* p-6 */
            margin-bottom: 2rem; /* mb-8 */
        }
        .main-title {
            font-size: 2.25rem; /* text-4xl */
            font-weight: 700; /* font-bold */
            color: #1F2937; /* gray-800 */
            margin-bottom: 1rem;
            text-align: center;
        }
        .section-title {
            font-size: 1.875rem; /* text-3xl */
            font-weight: 600; /* font-semibold */
            color: #A78BFA; /* violet-400 */
            margin-bottom: 1.5rem; /* mb-6 */
            padding-bottom: 0.5rem; /* pb-2 */
            border-bottom: 2px solid #E7E5E4; /* stone-200 */
        }
        .subsection-title {
            font-size: 1.5rem; /* text-2xl */
            font-weight: 600; /* font-semibold */
            color: #7DD3FC; /* sky-400 */
            margin-top: 1.5rem; /* mt-6 */
            margin-bottom: 1rem; /* mb-4 */
        }
        .content-text {
            line-height: 1.75;
            color: #4B5563; /* gray-600 */
            font-size: 0.95rem;
        }
        .highlight {
            color: #F97316; /* orange-500 */
            font-weight: 600;
        }
        .tab-button {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem; /* rounded-md */
            font-weight: 500;
            font-size: 0.875rem; /* text-sm */
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s;
            background-color: #E7E5E4; /* stone-200 */
            color: #374151; /* gray-700 */
            border: 1px solid transparent;
        }
        .tab-button.active {
            background-color: #A78BFA; /* violet-400 */
            color: #FFFFFF;
            border-color: #8B5CF6; /* violet-500 */
        }
        .nav-link {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem; /* rounded-md */
            font-weight: 500;
            color: #374151; /* gray-700 */
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
            white-space: nowrap;
        }
        .nav-link:hover, .nav-link.active {
            background-color: #A78BFA; /* violet-400 */
            color: #FFFFFF;
        }
        .kpi-card {
            background-color: #F9FAFB; /* gray-50 */
            border: 1px solid #E7E5E4; /* stone-200 */
            border-radius: 0.5rem; /* rounded-lg */
            padding: 1rem;
            text-align: center;
        }
        .kpi-label {
            font-size: 0.875rem; /* text-sm */
            color: #6B7280; /* gray-500 */
            margin-bottom: 0.25rem;
        }
        .kpi-value {
            font-size: 1.75rem; /* text-2xl or 3xl */
            font-weight: 600;
            color: #1F2937; /* gray-800 */
        }
    </style>
</head>
<body class="min-h-screen">

    <header class="sticky top-0 z-50 bg-white/95 backdrop-blur-md shadow-md">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex-shrink-0">
                    <h1 class="text-xl font-bold" style="color: #A78BFA;">IDEXX Laboratories (IDXX) Analysis</h1>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-1 lg:space-x-2">
                        <a href="#overview" class="nav-link">Overview</a>
                        <a href="#segments" class="nav-link">Business Segments</a>
                        <a href="#financials" class="nav-link">Financials</a>
                        <a href="#competition" class="nav-link">Competitive Moat</a>
                        <a href="#outlook" class="nav-link">Outlook</a>
                    </div>
                </div>
                <div class="md:hidden">
                    <button id="mobile-menu-button" type="button" class="inline-flex items-center justify-center p-2 rounded-md text-gray-500 hover:text-gray-700 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-violet-500" aria-controls="mobile-menu" aria-expanded="false">
                        <span class="sr-only">Open main menu</span>
                        <svg class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
                        <svg class="hidden h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
            </div>
            <div class="md:hidden hidden" id="mobile-menu">
                <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                    <a href="#overview" class="nav-link block text-base">Overview</a>
                    <a href="#segments" class="nav-link block text-base">Business Segments</a>
                    <a href="#financials" class="nav-link block text-base">Financials</a>
                    <a href="#competition" class="nav-link block text-base">Competitive Moat</a>
                    <a href="#outlook" class="nav-link block text-base">Outlook</a>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mx-auto p-4 md:p-6 lg:p-8 mt-4">

        <section id="overview" class="section-card scroll-mt-20">
            <h2 class="section-title">IDEXX Laboratories: The Leader in Veterinary Diagnostics</h2>
            <p class="content-text mb-6">IDEXX Laboratories, Inc. (NASDAQ: IDXX) is a global leader in the development, manufacture, and distribution of diagnostic products, equipment, and services for the veterinary, livestock, poultry, and water testing markets. The company's core business revolves around its Companion Animal Group (CAG), which provides veterinarians with a comprehensive suite of diagnostic solutions. This analysis explores IDEXX's powerful "razor-and-blade" business model, its consistent financial performance, and its strategic position in the growing animal health industry.</p>
            
            <div class="grid md:grid-cols-2 gap-6 items-start">
                <div>
                    <h3 class="subsection-title !mt-0">Core Business Strategy</h3>
                    <p class="content-text mb-4">IDEXX's strategy is focused on innovation, integration, and expanding its installed base:</p>
                    <ul class="list-disc list-inside content-text space-y-1 pl-4">
                        <li><strong class="font-semibold text-gray-700">The "Razor-and-Blade" Model:</strong> Placing diagnostic instruments ("razors") in veterinary clinics to drive a recurring stream of high-margin consumable sales ("blades").</li>
                        <li><strong class="font-semibold text-gray-700">Innovation and R&D:</strong> Continuously launching new and improved diagnostic tests and instruments to enhance the standard of care and expand its product portfolio.</li>
                        <li><strong class="font-semibold text-gray-700">Integrated Platform:</strong> Offering a suite of solutions that includes in-clinic diagnostics, reference laboratory services, and practice management software, creating a sticky ecosystem for veterinarians.</li>
                    </ul>
                </div>
                <div class="kpi-card bg-violet-50 border-violet-200">
                    <p class="kpi-label">CAG Diagnostics Recurring Revenue Growth (Q4 2023)</p>
                    <p class="kpi-value text-violet-600">10% Organic</p>
                    <p class="content-text text-sm mt-2">This is the key metric for IDEXX, reflecting the health of its core business and its ability to drive growth through both new instrument placements and increased utilization.</p>
                </div>
            </div>
        </section>

        <section id="segments" class="section-card scroll-mt-20">
            <h2 class="section-title">How IDEXX Makes Money: A Diversified Portfolio</h2>
            <p class="content-text mb-6">IDEXX operates through three main business segments. The Companion Animal Group (CAG) is by far the largest and most important, but the company also has significant businesses in Water Quality and Livestock, Poultry, and Dairy (LPD).</p>

            <div class="mb-6 border-b border-stone-200">
                <nav class="-mb-px flex space-x-4" aria-label="Tabs">
                    <button class="segment-tab-button active" data-target="cag">Companion Animal Group (CAG)</button>
                    <button class="segment-tab-button" data-target="water">Water Quality</button>
                    <button class="segment-tab-button" data-target="lpd">Livestock, Poultry & Dairy (LPD)</button>
                </nav>
            </div>

            <div id="segmentDetails">
                <div id="cagContent" class="segment-content">
                    <h3 class="subsection-title">Companion Animal Group (CAG)</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <p class="content-text mb-2">This segment, representing over 90% of revenue, provides diagnostic and information technology-based products and services to veterinarians. The business model is a classic "razor-and-blade" strategy, where the placement of instruments drives a highly recurring stream of consumable sales.</p>
                             <ul class="list-disc list-inside content-text space-y-1 pl-4 mt-4">
                                <li><strong>IDEXX VetLab¬Æ:</strong> In-clinic diagnostic instruments (chemistry, hematology, etc.).</li>
                                <li><strong>Consumables:</strong> The high-margin, single-use tests and slides used with the VetLab instruments.</li>
                                <li><strong>Reference Laboratories:</strong> A global network of labs for more advanced diagnostic testing.</li>
                                <li><strong>Rapid Assay Tests:</strong> Point-of-care SNAP tests for common infectious diseases.</li>
                             </ul>
                        </div>
                        <div class="chart-container h-72 md:h-80">
                            <canvas id="revenueBreakdownChart"></canvas>
                        </div>
                    </div>
                </div>
                <div id="waterContent" class="segment-content hidden">
                    <h3 class="subsection-title">Water Quality Products</h3>
                     <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                         <div>
                            <p class="content-text mb-2">IDEXX is a global leader in water microbiology testing. The company provides tests to detect the presence of various microbiological contaminants in water, serving municipalities and private water laboratories worldwide.</p>
                            <ul class="list-disc list-inside content-text space-y-1 pl-4 mt-4">
                                 <li><strong>Colilert¬Æ and Colilert-18¬Æ:</strong> The company's flagship products for detecting coliforms and E. coli in water.</li>
                            </ul>
                        </div>
                         <div class="kpi-card bg-sky-50 border-sky-200">
                             <p class="kpi-label">Market Position</p>
                             <p class="kpi-value text-sky-600">Global Leader</p>
                             <p class="content-text text-sm mt-2">IDEXX's water testing business holds a strong market-leading position in many parts of the world.</p>
                         </div>
                    </div>
                </div>
                 <div id="lpdContent" class="segment-content hidden">
                    <h3 class="subsection-title">Livestock, Poultry, and Dairy (LPD)</h3>
                     <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                         <div>
                            <p class="content-text mb-2">The LPD segment provides diagnostic tests and services that are used to manage the health of livestock and poultry and to ensure the quality and safety of milk and other dairy products.</p>
                        </div>
                         <div class="kpi-card bg-teal-50 border-teal-200">
                             <p class="kpi-label">Smallest Segment</p>
                             <p class="kpi-value text-teal-600">< 5% of Revenue</p>
                             <p class="content-text text-sm mt-2">While a stable business, the LPD segment is the smallest of IDEXX's three main business lines.</p>
                         </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="financials" class="section-card scroll-mt-20">
            <h2 class="section-title">Financial Deep Dive</h2>
            <p class="content-text mb-6">IDEXX has a long and impressive history of consistent financial performance. The company has delivered steady revenue growth, expanding operating margins, and strong earnings growth for many years. This financial strength is a testament to the company's powerful business model and its leadership position in the resilient animal health market.</p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div>
                    <h3 class="subsection-title">Fiscal Year Trends (2020-2024)</h3>
                    <div class="mb-4">
                        <label for="yearlyMetricSelect" class="block text-sm font-medium text-gray-700 mb-1">Select Annual Metric:</label>
                        <select id="yearlyMetricSelect" class="block w-full p-2 border border-stone-300 rounded-md shadow-sm focus:ring-violet-500 focus:border-violet-500">
                            <option value="totalRevenue" selected>Total Revenue ($B)</option>
                            <option value="netIncome">Net Income ($M)</option>
                            <option value="eps">Diluted EPS ($)</option>
                        </select>
                    </div>
                    <div id="yearlyFinancialChartContainer" class="chart-container h-80 max-w-full">
                        <canvas id="yearlyFinancialChart"></canvas>
                    </div>
                </div>

                <div>
                    <h3 class="subsection-title">Quarterly Trends (Recent 8 Qtrs)</h3>
                     <div class="mb-4">
                        <label for="quarterlyMetricSelect" class="block text-sm font-medium text-gray-700 mb-1">Select Quarterly Metric:</label>
                        <select id="quarterlyMetricSelect" class="block w-full p-2 border border-stone-300 rounded-md shadow-sm focus:ring-violet-500 focus:border-violet-500">
                             <option value="totalRevenue" selected>Total Revenue ($M)</option>
                             <option value="grossMargin">Gross Margin (%)</option>
                             <option value="opMargin">Operating Margin (%)</option>
                        </select>
                    </div>
                    <div id="quarterlyFinancialChartContainer" class="chart-container h-80 max-w-full">
                        <canvas id="quarterlyFinancialChart"></canvas>
                    </div>
                </div>
            </div>
             <p class="content-text text-sm mt-6 text-center">The financial charts showcase IDEXX's consistent growth and strong, stable profitability, hallmarks of a high-quality "compounder" stock.</p>
        </section>

        <section id="competition" class="section-card scroll-mt-20">
            <h2 class="section-title">Competitive Moat: The Razor-and-Blade Ecosystem</h2>
            <p class="content-text mb-6">IDEXX's primary competitive advantage is its powerful "razor-and-blade" business model, which creates high switching costs and a virtuous cycle of growth. Once a veterinary clinic invests in IDEXX's diagnostic instruments, they are effectively locked into a long-term stream of high-margin consumable purchases.</p>
            
            <div class="grid md:grid-cols-2 gap-8">
                <div>
                    <h3 class="subsection-title !mt-0">Key Moats</h3>
                    <ul class="list-none space-y-3">
                        <li class="flex items-start">
                            <span class="text-violet-500 mr-2 mt-1">‚ûî</span>
                            <span class="content-text"><strong class="text-gray-700">High Switching Costs:</strong> The significant upfront investment in diagnostic instruments, coupled with the integration of these systems into a clinic's workflow and practice management software, makes it very difficult and costly for a veterinarian to switch to a competitor.</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-violet-500 mr-2 mt-1">‚ûî</span>
                            <span class="content-text"><strong class="text-gray-700">Innovation & R&D:</strong> IDEXX consistently outspends its competitors on research and development, allowing it to bring new and innovative tests and instruments to market that enhance the standard of care and strengthen its product portfolio.</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-violet-500 mr-2 mt-1">‚ûî</span>
                            <span class="content-text"><strong class="text-gray-700">Global Direct Distribution:</strong> The company's large, direct sales force builds strong relationships with veterinarians, providing a high level of service and support that further entrenches IDEXX's position in the market.</span>
                        </li>
                    </ul>
                </div>
                <div>
                    <h3 class="subsection-title !mt-0">Primary Competitors</h3>
                     <ul class="list-none space-y-3">
                        <li class="flex items-start">
                            <span class="text-sky-500 mr-2 mt-1">‚óè</span>
                            <span class="content-text"><strong class="text-gray-700">Zoetis (ZTS):</strong> A global leader in animal health, Zoetis has been expanding its presence in the diagnostics market and is IDEXX's most formidable competitor.</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-sky-500 mr-2 mt-1">‚óè</span>
                            <span class="content-text"><strong class="text-gray-700">Mars, Inc. (Private):</strong> Through its ownership of Antech Diagnostics, VCA Animal Hospitals, and Heska, the privately-held Mars, Inc. is a major integrated player in the veterinary diagnostics and services market.</span>
                        </li>
                    </ul>
                </div>
            </div>
        </section>

        <section id="outlook" class="section-card scroll-mt-20">
            <h2 class="section-title">Strategic Outlook: Risks & Rewards</h2>
            <p class="content-text mb-6">IDEXX is a high-quality, market-leading company with a long runway for growth, driven by the enduring trend of pet humanization and increased spending on pet care. However, the company's premium valuation and the increasing competition in the diagnostics space are key factors for investors to consider.</p>
            <div class="grid md:grid-cols-2 gap-8">
                <div>
                    <h3 class="subsection-title !mt-0 text-teal-600">Rewards & Opportunities üöÄ</h3>
                    <ul class="list-disc list-inside content-text space-y-2 pl-4">
                        <li><strong>Durable Secular Growth:</strong> The humanization of pets is a powerful, long-term trend that is driving increased spending on veterinary care and diagnostics.</li>
                        <li><strong>International Expansion:</strong> There is a significant opportunity for IDEXX to expand its presence in international markets, where the standard of veterinary care is still developing.</li>
                        <li><strong>Innovation Pipeline:</strong> The company's strong R&D engine continues to produce new and innovative products that expand its addressable market and enhance its competitive position.</li>
                        <li><strong>Pricing Power:</strong> As the market leader with a differentiated product portfolio, IDEXX has demonstrated the ability to consistently raise prices, which is a key driver of revenue growth.</li>
                    </ul>
                </div>
                <div>
                    <h3 class="subsection-title !mt-0 text-orange-600">Risks & Challenges üìâ</h3>
                    <ul class="list-disc list-inside content-text space-y-2 pl-4">
                        <li><strong>Intense Competition:</strong> The veterinary diagnostics market is becoming increasingly competitive, with large, well-funded rivals like Zoetis and Mars vying for market share.</li>
                        <li><strong>Macroeconomic Sensitivity:</strong> While pet care is relatively resilient, a severe economic downturn could lead to a slowdown in discretionary veterinary spending.</li>
                        <li><strong>High Valuation:</strong> IDEXX has historically traded at a premium valuation, which could make the stock vulnerable to a market correction or any slowdown in its growth trajectory.</li>
                        <li><strong>Supply Chain Risk:</strong> The company relies on a complex global supply chain for its instruments and consumables, which could be subject to disruptions.</li>
                    </ul>
                </div>
            </div>
        </section>

        <footer class="bg-stone-800 text-stone-300 py-8 text-center mt-12">
            <p class="text-sm">&copy; <span id="currentYearFooter"></span> TickerHack Deep Research. For informational purposes only.</p>
            <p class="text-xs mt-1">Data synthesized from IDEXX Laboratories, Inc. public filings (SEC 10-K & 10-Q reports) and credible financial data providers as of June 2025.</p>
        </footer>

    <script>
        document.getElementById('currentYearFooter').textContent = new Date().getFullYear();

        // Mobile menu toggle
        const mobileMenuBtn = document.getElementById('mobile-menu-button');
        const mobileMenuEl = document.getElementById('mobile-menu');
        mobileMenuBtn.addEventListener('click', () => {
            mobileMenuEl.classList.toggle('hidden');
            mobileMenuBtn.querySelectorAll('svg').forEach(svg => svg.classList.toggle('hidden'));
        });
        
        // Smooth scroll and active nav link highlighting
        const navLinks = document.querySelectorAll('header nav a[href^="#"]');
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                if (mobileMenuEl && !mobileMenuEl.classList.contains('hidden')) {
                    mobileMenuBtn.click(); // Close mobile menu if open
                }
                navLinks.forEach(l => l.classList.remove('active'));
                e.currentTarget.classList.add('active');
            });
        });
        
        // Segment Tabs
        const segmentTabs = document.querySelectorAll('.segment-tab-button');
        const segmentContents = document.querySelectorAll('.segment-content');
        segmentTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                segmentTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                const targetId = tab.dataset.target + 'Content';
                segmentContents.forEach(content => {
                    content.id === targetId ? content.classList.remove('hidden') : content.classList.add('hidden');
                });
            });
        });

        // Chart.js Global Config
        Chart.defaults.font.family = 'Inter, sans-serif';
        Chart.defaults.color = '#4B5563';

        const CHART_COLORS = {
            violet: '#A78BFA',
            sky: '#7DD3FC',
            orange: '#FDBA74',
            stone: '#E7E5E4',
            gray: '#4B5563',
            darkViolet: '#8B5CF6',
            darkSky: '#38BDF8',
            teal: '#5EEAD4'
        };

        // Revenue Breakdown Chart
        const revenueBreakdownCtx = document.getElementById('revenueBreakdownChart').getContext('2d');
        new Chart(revenueBreakdownCtx, {
            type: 'doughnut',
            data: {
                labels: ['CAG', 'Water', 'LPD'],
                datasets: [{
                    data: [92, 5, 3], // Approximate percentages
                    backgroundColor: [CHART_COLORS.violet, CHART_COLORS.sky, CHART_COLORS.teal],
                    hoverOffset: 4
                }]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { position: 'bottom' }, title: { display: true, text: 'Revenue by Segment' } }
            }
        });

        // --- FINANCIAL CHARTS LOGIC ---

        // Yearly Data Store
        const yearlyDataStore = {
            labels: ['FY20', 'FY21', 'FY22', 'FY23', 'FY24'],
            totalRevenue: { data: [2.71, 3.22, 3.37, 3.66, 3.90], label: 'Total Revenue ($B)', color: CHART_COLORS.violet },
            netIncome: { data: [581, 747, 680, 845, 888], label: 'Net Income ($M)', color: CHART_COLORS.sky },
            eps: { data: [6.71, 8.60, 8.03, 10.06, 10.67], label: 'Diluted EPS ($)', color: CHART_COLORS.teal }
        };

        // Quarterly Data Store
        const quarterlyDataStore = {
            labels: ['Q2 23', 'Q3 23', 'Q4 23', 'Q1 24', 'Q2 24', 'Q3 24', 'Q4 24', 'Q1 25'],
            totalRevenue: { data: [944, 916, 902, 964, 1004, 976, 954, 998], label: 'Total Revenue ($M)', color: CHART_COLORS.violet },
            grossMargin: { data: [59.4, 59.8, 59.9, 60.1, 60.5, 61.1, 61.5, 61.8], label: 'Gross Margin (%)', color: CHART_COLORS.orange },
            opMargin: { data: [29.9, 30.2, 30.1, 30.5, 30.8, 31.0, 31.2, 31.5], label: 'Operating Margin (%)', color: CHART_COLORS.darkViolet }
        };

        let yearlyChart = null;
        let quarterlyChart = null;
        const yearlySelect = document.getElementById('yearlyMetricSelect');
        const quarterlySelect = document.getElementById('quarterlyMetricSelect');
        const yearlyCanvas = document.getElementById('yearlyFinancialChart').getContext('2d');
        const quarterlyCanvas = document.getElementById('quarterlyFinancialChart').getContext('2d');

        function createChart(canvas, existingChart, dataStore, metricKey) {
            if (existingChart) {
                existingChart.destroy();
            }
            const metricDetails = dataStore[metricKey];
            const isLineChart = metricKey === 'eps' || metricKey === 'grossMargin' || metricKey === 'opMargin';

            return new Chart(canvas, {
                type: 'bar',
                data: {
                    labels: dataStore.labels,
                    datasets: [{
                        label: metricDetails.label,
                        data: metricDetails.data,
                        backgroundColor: isLineChart ? 'transparent' : metricDetails.color + 'BF',
                        borderColor: metricDetails.color,
                        borderWidth: 2,
                        type: isLineChart ? 'line' : 'bar',
                        fill: !isLineChart,
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { 
                        y: { 
                            beginAtZero: false, 
                            title: { display: true, text: metricDetails.label.split('(')[1].replace(')','') }
                        } 
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }
        
        yearlySelect.addEventListener('change', (event) => {
            yearlyChart = createChart(yearlyCanvas, yearlyChart, yearlyDataStore, event.target.value);
        });

        quarterlySelect.addEventListener('change', (event) => {
            quarterlyChart = createChart(quarterlyCanvas, quarterlyChart, quarterlyDataStore, event.target.value);
        });

        // Initial chart renders
        yearlyChart = createChart(yearlyCanvas, yearlyChart, yearlyDataStore, 'totalRevenue');
        quarterlyChart = createChart(quarterlyCanvas, quarterlyChart, quarterlyDataStore, 'totalRevenue');

    </script>
</body>
</html>

