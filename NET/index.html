<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloudflare, Inc. (NET) - TickerHack Deep Research</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F5F5F4; /* stone-100 */
            color: #374151; /* gray-700 */
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 350px;
        }
        @media (min-width: 768px) { /* md */
            .chart-container {
                height: 350px;
                max-height: 400px;
            }
        }
        .section-card {
            background-color: #FFFFFF;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.07), 0 4px 6px -2px rgba(0, 0, 0, 0.04); /* Softer shadow */
            padding: 1.5rem; /* p-6 */
            margin-bottom: 2rem; /* mb-8 */
        }
        .main-title {
            font-size: 2.25rem; /* text-4xl */
            font-weight: 700; /* font-bold */
            color: #1F2937; /* gray-800 */
            margin-bottom: 1rem;
            text-align: center;
        }
        .section-title {
            font-size: 1.875rem; /* text-3xl */
            font-weight: 600; /* font-semibold */
            color: #F48120; /* Cloudflare Orange */
            margin-bottom: 1.5rem; /* mb-6 */
            padding-bottom: 0.5rem; /* pb-2 */
            border-bottom: 2px solid #E7E5E4; /* stone-200 */
        }
        .subsection-title {
            font-size: 1.5rem; /* text-2xl */
            font-weight: 600; /* font-semibold */
            color: #FB923C; /* Lighter Orange */
            margin-top: 1.5rem; /* mt-6 */
            margin-bottom: 1rem; /* mb-4 */
        }
        .content-text {
            line-height: 1.75;
            color: #4B5563; /* gray-600 */
            font-size: 0.95rem;
        }
        .highlight {
            color: #F48120; /* Cloudflare Orange */
            font-weight: 600;
        }
        .tab-button {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem; /* rounded-md */
            font-weight: 500;
            font-size: 0.875rem; /* text-sm */
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s;
            background-color: #E7E5E4; /* stone-200 */
            color: #374151; /* gray-700 */
            border: 1px solid transparent;
        }
        .tab-button.active {
            background-color: #F48120; /* Cloudflare Orange */
            color: #FFFFFF;
            border-color: #EA580C; 
        }
        .nav-link {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem; /* rounded-md */
            font-weight: 500;
            color: #374151; /* gray-700 */
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
            white-space: nowrap;
        }
        .nav-link:hover, .nav-link.active {
            background-color: #F48120; /* Cloudflare Orange */
            color: #FFFFFF;
        }
        .kpi-card {
            background-color: #F9FAFB; /* gray-50 */
            border: 1px solid #E7E5E4; /* stone-200 */
            border-radius: 0.5rem; /* rounded-lg */
            padding: 1rem;
            text-align: center;
        }
        .kpi-label {
            font-size: 0.875rem; /* text-sm */
            color: #6B7280; /* gray-600 */
            margin-bottom: 0.25rem;
        }
        .kpi-value {
            font-size: 1.75rem; /* text-2xl or 3xl */
            font-weight: 600;
            color: #1F2937; /* gray-800 */
        }
    </style>
</head>
<body class="min-h-screen">

    <header class="sticky top-0 z-50 bg-white/95 backdrop-blur-md shadow-md">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex-shrink-0">
                    <h1 class="text-xl font-bold" style="color: #F48120;">Cloudflare (NET) Analysis</h1>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-1 lg:space-x-2">
                        <a href="#overview" class="nav-link">Overview</a>
                        <a href="#segments" class="nav-link">Business Model</a>
                        <a href="#financials" class="nav-link">Financials & KPIs</a>
                        <a href="#competition" class="nav-link">Competitive Moat</a>
                        <a href="#outlook" class="nav-link">Outlook</a>
                    </div>
                </div>
                <div class="md:hidden">
                    <button id="mobile-menu-button" type="button" class="inline-flex items-center justify-center p-2 rounded-md text-gray-500 hover:text-gray-700 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-orange-500" aria-controls="mobile-menu" aria-expanded="false">
                        <span class="sr-only">Open main menu</span>
                        <svg class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
                        <svg class="hidden h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
            </div>
            <div class="md:hidden hidden" id="mobile-menu">
                <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                    <a href="#overview" class="nav-link block text-base">Overview</a>
                    <a href="#segments" class="nav-link block text-base">Business Model</a>
                    <a href="#financials" class="nav-link block text-base">Financials & KPIs</a>
                    <a href="#competition" class="nav-link block text-base">Competitive Moat</a>
                    <a href="#outlook" class="nav-link block text-base">Outlook</a>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mx-auto p-4 md:p-6 lg:p-8 mt-4">

        <section id="overview" class="section-card scroll-mt-20">
            <h2 class="section-title">Cloudflare: Building a Better Internet</h2>
            <p class="content-text mb-6">Cloudflare is a global cloud platform that provides a broad range of network services to businesses of all sizes, making their internet-facing applications faster, more secure, and more reliable. Its business model is built on a massive, intelligent global network that sits in front of its customers' infrastructure, acting as a "reverse proxy" to filter and accelerate traffic. Cloudflare's core strategy is a classic <span class="highlight">"land-and-expand"</span> motion, using a powerful freemium offering to attract millions of users and then upselling them to its advanced, subscription-based security, performance, and developer services. The company's ultimate ambition is to become the fourth major public cloud, built for the new era of AI and edge computing. This analysis explores Cloudflare's powerful business model, its impressive growth metrics, and its strategic positioning.</p>
            
            <div class="grid md:grid-cols-2 gap-6 items-start">
                <div>
                    <h3 class="subsection-title !mt-0">Core Business Strategy</h3>
                    <p class="content-text mb-4">Cloudflare's strategy is focused on product innovation and network effects:</p>
                    <ul class="list-disc list-inside content-text space-y-1 pl-4">
                        <li><strong class="font-semibold text-gray-700">Innovate and Expand the Product Suite:</strong> Continuously launch new products and features that can be sold to the existing customer base, increasing the "attach rate" and lifetime value.</li>
                        <li><strong class="font-semibold text-gray-700">Leverage Network Effects:</strong> The more traffic that runs on Cloudflare's network, the more data it has to identify and block security threats, making the service more valuable for every user.</li>
                        <li><strong class="font-semibold text-gray-700">Win with Developers:</strong> Build a programmable, serverless computing platform (**Cloudflare Workers**) that is fast, affordable, and easy for developers to use, creating a powerful new ecosystem on the edge.</li>
                        <li><strong class="font-semibold text-gray-700">Target Enterprise Customers:</strong> Focus the direct sales motion on landing and expanding large enterprise customers, who are increasingly adopting the **Cloudflare One** Zero Trust security platform.</li>
                    </ul>
                </div>
                <div class="kpi-card bg-orange-50 border-orange-200">
                    <p class="kpi-label">Dollar-Based Net Retention Rate</p>
                    <p class="kpi-value text-orange-600">~115%</p>
                    <p class="content-text text-sm mt-2">This key metric shows that Cloudflare's existing customers, on average, increased their spending by 15% year-over-year, proving the success of the "land-and-expand" model.</p>
                </div>
            </div>
        </section>

        <section id="segments" class="section-card scroll-mt-20">
            <h2 class="section-title">How Cloudflare Makes Money: The Integrated Platform</h2>
            <p class="content-text mb-6">Cloudflare operates as a single, integrated platform and does not report formal segments. However, its business can be understood through its three major product suites, which address different customer needs but are all built on top of its unified global network. Revenue is generated almost entirely from monthly or annual subscriptions, with pricing tiers based on usage and feature access.</p>

            <div class="mb-6 border-b border-stone-200">
                <nav class="-mb-px flex space-x-4" aria-label="Tabs">
                    <button class="segment-tab-button active" data-target="app">Application Services</button>
                    <button class="segment-tab-button" data-target="one">Cloudflare One</button>
                    <button class="segment-tab-button" data-target="dev">Developer Platform</button>
                </nav>
            </div>

            <div id="segmentDetails">
                <div id="appContent" class="segment-content">
                    <h3 class="subsection-title">Application Services</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <p class="content-text mb-2">This is Cloudflare's original and most well-known product suite. It focuses on improving the performance and security of public-facing websites, APIs, and applications. This suite is the primary "on-ramp" for new customers, who often start with the free tier and upgrade for more advanced features. Key services include the Content Delivery Network (CDN), DDoS Mitigation, and Web Application Firewall (WAF).</p>
                        </div>
                        <div class="chart-container h-72 md:h-80">
                            <canvas id="revenueBreakdownChart"></canvas>
                        </div>
                    </div>
                </div>
                <div id="oneContent" class="segment-content hidden">
                    <h3 class="subsection-title">Cloudflare One (Zero Trust)</h3>
                     <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                         <div>
                            <p class="content-text mb-2">This is a major growth driver and a key focus for enterprise sales. Cloudflare One is a comprehensive Secure Access Service Edge (SASE) platform that helps companies secure their internal employees, devices, and data. It replaces traditional corporate network security appliances (like firewalls and VPNs) with a cloud-native, <span class="highlight">Zero Trust</span> security model. This is a massive market where Cloudflare is competing to displace legacy vendors.</p>
                        </div>
                        <div class="kpi-card bg-orange-50 border-orange-200 p-6 flex flex-col justify-center">
                            <p class="kpi-label">Strategic Focus</p>
                            <p class="kpi-value text-orange-600 text-2xl">Zero Trust</p>
                            <p class="content-text text-sm mt-2">Cloudflare One aims to be the leading platform for Zero Trust security, a modern approach where no user or device is trusted by default, significantly improving corporate security.</p>
                        </div>
                    </div>
                </div>
                <div id="devContent" class="segment-content hidden">
                    <h3 class="subsection-title">Developer Platform</h3>
                     <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                         <div>
                            <p class="content-text mb-2">This is the most forward-looking part of Cloudflare's strategy. The centerpiece is <span class="highlight">Cloudflare Workers</span>, a serverless computing platform that allows developers to run their application code directly on Cloudflare's global edge network. By running code closer to the end-user, applications can achieve significantly lower latency and better performance. This platform is the foundation of Cloudflare's ambition to become a fourth major public cloud, purpose-built for the AI era's focus on low-latency inference.</p>
                        </div>
                        <div class="kpi-card bg-orange-50 border-orange-200 p-6 flex flex-col justify-center">
                            <p class="kpi-label">Flagship Product</p>
                            <p class="kpi-value text-orange-600 text-2xl">Cloudflare Workers</p>
                            <p class="content-text text-sm mt-2">A high-performance serverless platform that represents the future of the company and its primary challenge to the major cloud providers.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="financials" class="section-card scroll-mt-20">
            <h2 class="section-title">Financials & Key Performance Indicators</h2>
            <p class="content-text mb-6">Cloudflare's financial profile is that of a classic high-growth SaaS company. It has consistently delivered rapid revenue growth while maintaining strong gross margins. While not yet profitable on a GAAP basis due to heavy investment in R&D and sales, the company is now consistently generating positive free cash flow. The most important KPIs are the growth in large customers (those paying >$100k annually) and the dollar-based net retention rate, both of which demonstrate its successful enterprise sales motion.</p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div>
                    <h3 class="subsection-title">Fiscal Year Trends (2020-2024)</h3>
                    <div class="mb-4">
                        <label for="yearlyMetricSelect" class="block text-sm font-medium text-gray-700 mb-1">Select Annual Metric:</label>
                        <select id="yearlyMetricSelect" class="block w-full p-2 border border-stone-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500">
                            <option value="netRevenue" selected>Total Revenue ($M)</option>
                            <option value="grossProfit">Gross Profit ($M)</option>
                        </select>
                    </div>
                    <div id="yearlyFinancialChartContainer" class="chart-container h-80 max-w-full">
                        <canvas id="yearlyFinancialChart"></canvas>
                    </div>
                </div>

                <div>
                    <h3 class="subsection-title">Growth in Large Customers</h3>
                     <div class="mb-4">
                        <label for="quarterlyMetricSelect" class="block text-sm font-medium text-gray-700 mb-1">View:</label>
                        <select id="quarterlyMetricSelect" class="block w-full p-2 border border-stone-300 rounded-md shadow-sm focus:ring-orange-500 focus:border-orange-500">
                            <option value="largeCustomers" selected>Customers > $100k ARR</option>
                        </select>
                    </div>
                    <div id="quarterlyFinancialChartContainer" class="chart-container h-80 max-w-full">
                        <canvas id="quarterlyFinancialChart"></canvas>
                    </div>
                </div>
            </div>
             <p class="content-text text-sm mt-6 text-center">The financial charts showcase rapid and consistent top-line growth. The customer chart highlights the success of the "land-and-expand" strategy, with the number of high-paying enterprise customers growing steadily each quarter.</p>
        </section>

        <section id="competition" class="section-card scroll-mt-20">
            <h2 class="section-title">Competitive Moat: The Network Flywheel</h2>
            <p class="content-text mb-6">Cloudflare has established a powerful competitive moat built on the scale and intelligence of its global network, a strong developer-focused brand, and a culture of relentless innovation. This creates a virtuous cycle that is difficult for competitors to replicate.</p>
            
            <div class="grid md:grid-cols-2 gap-8">
                <div>
                    <h3 class="subsection-title !mt-0">Key Moats</h3>
                    <ul class="list-none space-y-3">
                        <li class="flex items-start">
                            <span class="text-orange-600 mr-2 mt-1">➔</span>
                            <span class="content-text"><strong class="text-gray-700">Massive Global Network & Scale:</strong> Cloudflare has one of the world's largest and most peered networks, handling a massive percentage of all internet traffic. This scale provides a significant performance and cost advantage. Replicating a network of this size and efficiency would require immense capital and time.</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-orange-600 mr-2 mt-1">➔</span>
                            <span class="content-text"><strong class="text-gray-700">Data Network Effects:</strong> Every request that flows through Cloudflare's network makes its security services smarter. The vast amount of threat data it analyzes allows it to identify and block new attacks in real-time for all its customers, creating a powerful flywheel effect: more users lead to better security, which attracts more users.</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-orange-600 mr-2 mt-1">➔</span>
                            <span class="content-text"><strong class="text-gray-700">Developer Mindshare & Switching Costs:</strong> By building a programmable network with products like Cloudflare Workers, the company is embedding itself deeply into its customers' application development process. As developers build on top of Cloudflare's platform, the switching costs become increasingly high.</span>
                        </li>
                    </ul>
                </div>
                <div>
                    <h3 class="subsection-title !mt-0">Primary Competitors</h3>
                     <ul class="list-none space-y-3">
                        <li class="flex items-start">
                            <span class="text-orange-400 mr-2 mt-1">●</span>
                            <span class="content-text"><strong class="text-gray-700">Cloud Hyperscalers:</strong> The largest threat comes from the major cloud providers—Amazon (AWS), Microsoft (Azure), and Google (GCP)—which offer their own competing CDN, security, and edge computing services.</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-orange-400 mr-2 mt-1">●</span>
                            <span class="content-text"><strong class="text-gray-700">Specialized Security Vendors:</strong> In the Zero Trust and SASE market, Cloudflare competes fiercely with cybersecurity leaders like Zscaler and Palo Alto Networks.</span>
                        </li>
                         <li class="flex items-start">
                            <span class="text-orange-400 mr-2 mt-1">●</span>
                             <span class="content-text"><strong class="text-gray-700">CDN & Edge Competitors:</strong> Competes with legacy Content Delivery Network providers like Akamai and other modern edge platforms like Fastly.</span>
                        </li>
                    </ul>
                </div>
            </div>
        </section>

        <section id="outlook" class="section-card scroll-mt-20">
            <h2 class="section-title">Strategic Outlook: Risks & Rewards</h2>
            <p class="content-text mb-6">The investment thesis for Cloudflare is a bet on a high-growth, innovative technology leader that is aiming to become a foundational piece of the internet's infrastructure. The rewards are tied to its massive market opportunity and successful execution, while the risks are centered on the intense competition from tech giants and its premium stock valuation.</p>
            <div class="grid md:grid-cols-2 gap-8">
                <div>
                    <h3 class="subsection-title !mt-0 text-teal-600">Rewards & Opportunities 🚀</h3>
                    <ul class="list-disc list-inside content-text space-y-2 pl-4">
                        <li><strong>Massive Addressable Market:</strong> Cloudflare is targeting huge and growing markets, including application services, Zero Trust security, and serverless computing.</li>
                        <li><strong>Becoming the Fourth Major Cloud:</strong> The biggest opportunity lies in the success of its developer platform. If Cloudflare Workers becomes the standard for building high-performance applications on the edge, the growth potential is immense.</li>
                        <li><strong>Strong "Land-and-Expand" Motion:</strong> A proven ability to attract customers with free products and consistently upsell them over time, as demonstrated by its high dollar-based net retention rate.</li>
                        <li><strong>AI Tailwinds:</strong> The need for low-latency, secure, and scalable infrastructure to run AI inference workloads at the edge plays directly into Cloudflare's strengths.</li>
                    </ul>
                </div>
                <div>
                    <h3 class="subsection-title !mt-0 text-red-600">Risks & Challenges 📉</h3>
                    <ul class="list-disc list-inside content-text space-y-2 pl-4">
                        <li><strong>Intense Competition:</strong> Faces fierce competition from some of the largest and most well-funded technology companies in the world (Amazon, Microsoft, Google), which have the scale and resources to compete aggressively.</li>
                        <li><strong>Premium Valuation:</strong> Cloudflare's stock trades at a very high price-to-sales multiple, which bakes in high expectations for future growth. Any stumble in execution could lead to significant stock price volatility.</li>
                        <li><strong>Path to GAAP Profitability:</strong> While free cash flow positive, the company has yet to achieve sustained profitability on a GAAP basis, primarily due to high stock-based compensation costs.</li>
                        <li><strong>Complexity of Enterprise Sales:</strong> Successfully scaling its enterprise sales force and competing for large, complex deals against established vendors is a major ongoing challenge.</li>
                    </ul>
                </div>
            </div>
        </section>

        <footer class="bg-stone-800 text-stone-300 py-8 text-center mt-12">
            <p class="text-sm">&copy; <span id="currentYearFooter"></span> TickerHack Deep Research. For informational purposes only.</p>
            <p class="text-xs mt-1">Data synthesized from Cloudflare, Inc. public filings and credible financial news sources as of June 2025.</p>
        </footer>

    <script>
        document.getElementById('currentYearFooter').textContent = new Date().getFullYear();

        // Mobile menu toggle
        const mobileMenuBtn = document.getElementById('mobile-menu-button');
        const mobileMenuEl = document.getElementById('mobile-menu');
        mobileMenuBtn.addEventListener('click', () => {
            mobileMenuEl.classList.toggle('hidden');
            mobileMenuBtn.querySelectorAll('svg').forEach(svg => svg.classList.toggle('hidden'));
        });
        
        // Smooth scroll and active nav link highlighting
        const navLinks = document.querySelectorAll('header nav a[href^="#"]');
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                if (!mobileMenuEl.classList.contains('hidden')) {
                    mobileMenuBtn.click(); // Close mobile menu if open
                }
                navLinks.forEach(l => l.classList.remove('active'));
                e.currentTarget.classList.add('active');
            });
        });
        
        // Segment Tabs
        const segmentTabs = document.querySelectorAll('.segment-tab-button');
        const segmentContents = document.querySelectorAll('.segment-content');
        segmentTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                segmentTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                const targetId = tab.dataset.target + 'Content';
                segmentContents.forEach(content => {
                    content.id === targetId ? content.classList.remove('hidden') : content.classList.add('hidden');
                });
            });
        });

        // Chart.js Global Config
        Chart.defaults.font.family = 'Inter, sans-serif';
        Chart.defaults.color = '#4B5563';

        const CHART_COLORS = {
            orange: '#F48120',
            sky: '#38BDF8',
            gray: '#6B7280',
        };

        // Revenue Breakdown Chart (Doughnut)
        const revenueBreakdownCtx = document.getElementById('revenueBreakdownChart').getContext('2d');
        new Chart(revenueBreakdownCtx, {
            type: 'doughnut',
            data: {
                labels: ['United States', 'Europe, Middle East, & Africa', 'Asia Pacific'],
                datasets: [{
                    label: 'FY2024 Revenue Mix',
                    data: [52, 27, 21], // Approximate revenue %
                    backgroundColor: [CHART_COLORS.orange, CHART_COLORS.sky, CHART_COLORS.gray],
                    hoverOffset: 4
                }]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { position: 'bottom' }, title: { display: true, text: 'FY2024 Revenue by Geography (%)' } }
            }
        });
        
        // --- FINANCIAL CHARTS LOGIC ---

        // Yearly Data Store
        const yearlyDataStore = {
            labels: ['FY20', 'FY21', 'FY22', 'FY23', 'FY24'],
            netRevenue: { data: [431, 656, 975, 1297, 1686], label: 'Total Revenue ($M)', color: CHART_COLORS.orange },
            grossProfit: { data: [330, 509, 747, 995, 1301], label: 'Gross Profit ($M)', color: CHART_COLORS.sky },
        };

        // Quarterly Data Store
        const quarterlyDataStore = {
            labels: ['Q2 23', 'Q3 23', 'Q4 23', 'Q1 24', 'Q2 24', 'Q3 24', 'Q4 24', 'Q1 25'],
            largeCustomers: { data: [2352, 2552, 2756, 2891, 3039, 3180, 3329, 3501], label: 'Customers > $100k/year', color: CHART_COLORS.orange },
        };

        let yearlyChart = null;
        let quarterlyChart = null;
        const yearlySelect = document.getElementById('yearlyMetricSelect');
        const quarterlySelect = document.getElementById('quarterlyMetricSelect');
        const yearlyCanvas = document.getElementById('yearlyFinancialChart').getContext('2d');
        const quarterlyCanvas = document.getElementById('quarterlyFinancialChart').getContext('2d');

        function createChart(canvas, existingChart, dataStore, metricKey) {
            if (existingChart) {
                existingChart.destroy();
            }
            const metricDetails = dataStore[metricKey];
            
            // Robustly determine Y-axis title
            let yAxisTitle = metricDetails.label; // Default to the full label
            const labelParts = metricDetails.label.split('(');
            if (labelParts.length > 1) {
                yAxisTitle = labelParts[1].replace(')','');
            }

            return new Chart(canvas, {
                type: 'bar',
                data: {
                    labels: dataStore.labels,
                    datasets: [{
                        label: metricDetails.label,
                        data: metricDetails.data,
                        backgroundColor: metricDetails.color + 'BF',
                        borderColor: metricDetails.color,
                        borderWidth: 1,
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { 
                        y: { 
                            beginAtZero: false, 
                            title: { 
                                display: true, 
                                text: yAxisTitle
                            } 
                        } 
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }
        
        yearlySelect.addEventListener('change', (event) => {
            yearlyChart = createChart(yearlyCanvas, yearlyChart, yearlyDataStore, event.target.value);
        });

        quarterlySelect.addEventListener('change', (event) => {
            quarterlyChart = createChart(quarterlyCanvas, quarterlyChart, quarterlyDataStore, event.target.value);
        });

        // Initial chart renders
        yearlyChart = createChart(yearlyCanvas, yearlyChart, yearlyDataStore, 'netRevenue');
        quarterlyChart = createChart(quarterlyCanvas, quarterlyChart, quarterlyDataStore, 'largeCustomers');

    </script>
</body>
</html>

