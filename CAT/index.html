<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caterpillar Inc. (CAT) - TickerHack Deep Research</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F5F5F4; /* stone-100 */
            color: #374151; /* gray-700 */
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 350px;
        }
        @media (min-width: 768px) { /* md */
            .chart-container {
                height: 350px;
                max-height: 400px;
            }
        }
        .section-card {
            background-color: #FFFFFF;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.07), 0 4px 6px -2px rgba(0, 0, 0, 0.04); /* Softer shadow */
            padding: 1.5rem; /* p-6 */
            margin-bottom: 2rem; /* mb-8 */
        }
        .main-title {
            font-size: 2.25rem; /* text-4xl */
            font-weight: 700; /* font-bold */
            color: #1F2937; /* gray-800 */
            margin-bottom: 1rem;
            text-align: center;
        }
        .section-title {
            font-size: 1.875rem; /* text-3xl */
            font-weight: 600; /* font-semibold */
            color: #FBBF24; /* amber-400 - Cat Yellow */
            margin-bottom: 1.5rem; /* mb-6 */
            padding-bottom: 0.5rem; /* pb-2 */
            border-bottom: 2px solid #E7E5E4; /* stone-200 */
        }
        .subsection-title {
            font-size: 1.5rem; /* text-2xl */
            font-weight: 600; /* font-semibold */
            color: #1F2937; /* Cat Black */
            margin-top: 1.5rem; /* mt-6 */
            margin-bottom: 1rem; /* mb-4 */
        }
        .content-text {
            line-height: 1.75;
            color: #4B5563; /* gray-600 */
            font-size: 0.95rem;
        }
        .highlight {
            color: #F97316; /* orange-500 */
            font-weight: 600;
        }
        .tab-button {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem; /* rounded-md */
            font-weight: 500;
            font-size: 0.875rem; /* text-sm */
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s;
            background-color: #E7E5E4; /* stone-200 */
            color: #374151; /* gray-700 */
            border: 1px solid transparent;
        }
        .tab-button.active {
            background-color: #FBBF24; /* amber-400 */
            color: #1F2937;
            border-color: #F59E0B; 
        }
        .nav-link {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem; /* rounded-md */
            font-weight: 500;
            color: #374151; /* gray-700 */
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
            white-space: nowrap;
        }
        .nav-link:hover, .nav-link.active {
            background-color: #FBBF24; /* amber-400 */
            color: #1F2937;
        }
        .kpi-card {
            background-color: #F9FAFB; /* gray-50 */
            border: 1px solid #E7E5E4; /* stone-200 */
            border-radius: 0.5rem; /* rounded-lg */
            padding: 1rem;
            text-align: center;
        }
        .kpi-label {
            font-size: 0.875rem; /* text-sm */
            color: #6B7280; /* gray-600 */
            margin-bottom: 0.25rem;
        }
        .kpi-value {
            font-size: 1.75rem; /* text-2xl or 3xl */
            font-weight: 600;
            color: #1F2937; /* gray-800 */
        }
    </style>
</head>
<body class="min-h-screen">

    <header class="sticky top-0 z-50 bg-white/95 backdrop-blur-md shadow-md">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex-shrink-0">
                    <h1 class="text-xl font-bold" style="color: #1F2937;">Caterpillar Inc. (CAT) Analysis</h1>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-1 lg:space-x-2">
                        <a href="#overview" class="nav-link">Overview</a>
                        <a href="#segments" class="nav-link">Business Segments</a>
                        <a href="#financials" class="nav-link">Financials</a>
                        <a href="#competition" class="nav-link">Competitive Moat</a>
                        <a href="#outlook" class="nav-link">Outlook</a>
                    </div>
                </div>
                <div class="md:hidden">
                    <button id="mobile-menu-button" type="button" class="inline-flex items-center justify-center p-2 rounded-md text-gray-500 hover:text-gray-700 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-amber-500" aria-controls="mobile-menu" aria-expanded="false">
                        <span class="sr-only">Open main menu</span>
                        <svg class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
                        <svg class="hidden h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
            </div>
            <div class="md:hidden hidden" id="mobile-menu">
                <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                    <a href="#overview" class="nav-link block text-base">Overview</a>
                    <a href="#segments" class="nav-link block text-base">Business Segments</a>
                    <a href="#financials" class="nav-link block text-base">Financials</a>
                    <a href="#competition" class="nav-link block text-base">Competitive Moat</a>
                    <a href="#outlook" class="nav-link block text-base">Outlook</a>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mx-auto p-4 md:p-6 lg:p-8 mt-4">

        <section id="overview" class="section-card scroll-mt-20">
            <h2 class="section-title">Caterpillar: Building the World</h2>
            <p class="content-text mb-6">Caterpillar Inc. is the world's leading manufacturer of construction and mining equipment, diesel and natural gas engines, industrial gas turbines, and diesel-electric locomotives. For nearly a century, the "Cat" brand has been synonymous with durability, reliability, and power. The company's business model is built on two pillars: selling its iconic yellow machines, and then supporting that massive installed base with a long tail of high-margin services, parts, and repairs. This is all enabled by its single greatest competitive advantage: an unparalleled global dealer network. This analysis explores Caterpillar's powerful business segments, its financial performance, and its strategic position as a premier global industrial company.</p>
            
            <div class="grid md:grid-cols-2 gap-6 items-start">
                <div>
                    <h3 class="subsection-title !mt-0">Core Business Strategy</h3>
                    <p class="content-text mb-4">Caterpillar's strategy is focused on profitable growth and shareholder returns:</p>
                    <ul class="list-disc list-inside content-text space-y-1 pl-4">
                        <li><strong class="font-semibold text-gray-700">Leverage the Dealer Network:</strong> Empower its unmatched global dealer network to provide sales, service, and support, creating a significant competitive advantage in customer reach and service quality.</li>
                        <li><strong class="font-semibold text-gray-700">Grow Services Revenue:</strong> A primary goal is to double its services revenue. This creates a more stable, higher-margin, recurring revenue stream that helps smooth the cyclicality of new equipment sales.</li>
                        <li><strong class="font-semibold text-gray-700">Operational Excellence:</strong> A relentless focus on lean manufacturing and cost discipline to improve profitability and maintain strong margins throughout the economic cycle.</li>
                        <li><strong class="font-semibold text-gray-700">Disciplined Capital Allocation:</strong> As a "Dividend Aristocrat," Caterpillar is committed to returning a majority of its free cash flow to shareholders through a consistently growing dividend and share repurchases.</li>
                    </ul>
                </div>
                <div class="kpi-card bg-amber-50 border-amber-200">
                    <p class="kpi-label">Global Dealer Network</p>
                    <p class="kpi-value text-amber-800">160 Dealers</p>
                    <p class="content-text text-sm mt-2">Represents Caterpillar's single greatest competitive advantage, providing an unmatched global footprint for sales and service in 197 countries.</p>
                </div>
            </div>
        </section>

        <section id="segments" class="section-card scroll-mt-20">
            <h2 class="section-title">How Caterpillar Makes Money: The Segments</h2>
            <p class="content-text mb-6">Caterpillar's business is organized into three primary machinery segments, whose performance is tied to different macroeconomic drivers, and a financial products segment that supports the sale of its equipment. **Construction Industries** is the largest, followed by the diverse **Energy & Transportation** segment and the highly cyclical **Resource Industries** segment.</p>

            <div class="mb-6 border-b border-stone-200">
                <nav class="-mb-px flex space-x-4" aria-label="Tabs">
                    <button class="segment-tab-button active" data-target="ci">Construction Industries</button>
                    <button class="segment-tab-button" data-target="ri">Resource Industries</button>
                    <button class="segment-tab-button" data-target="et">Energy & Transportation</button>
                </nav>
            </div>

            <div id="segmentDetails">
                <div id="ciContent" class="segment-content">
                    <h3 class="subsection-title">Construction Industries</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <p class="content-text mb-2">This is Caterpillar's largest segment, responsible for supporting customers in infrastructure, forestry, and building construction. It manufactures a vast lineup of machinery including asphalt pavers, compactors, backhoes, excavators, and loaders. The performance of this segment is closely tied to residential and non-residential construction activity and government infrastructure spending.</p>
                        </div>
                        <div class="chart-container h-72 md:h-80">
                            <canvas id="segmentBreakdownChart"></canvas>
                        </div>
                    </div>
                </div>
                <div id="riContent" class="segment-content hidden">
                    <h3 class="subsection-title">Resource Industries</h3>
                     <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                         <div>
                            <p class="content-text mb-2">The Resource Industries segment is responsible for serving customers in mining, quarrying, and heavy construction. It produces some of the largest machines on earth, including massive off-highway trucks, electric rope shovels, and rotary drills. The performance of this segment is highly cyclical and dependent on global commodity prices, which drive mining company capital expenditures.</p>
                        </div>
                        <div class="kpi-card bg-amber-50 border-amber-200 p-6 flex flex-col justify-center">
                            <p class="kpi-label">Key Driver</p>
                            <p class="kpi-value text-amber-800 text-2xl">Commodity Prices</p>
                            <p class="content-text text-sm mt-2">Demand for mining equipment is directly linked to the capital expenditure budgets of mining companies, which are driven by the price of commodities like copper and iron ore.</p>
                        </div>
                    </div>
                </div>
                <div id="etContent" class="segment-content hidden">
                    <h3 class="subsection-title">Energy & Transportation</h3>
                     <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                         <div>
                            <p class="content-text mb-2">This is a highly diverse segment that supports customers in the oil and gas, power generation, marine, rail, and industrial sectors. It manufactures reciprocating engines, gas turbines, diesel-electric locomotives, and a wide array of other power systems. This segment's diversity provides a more stable revenue stream compared to the more cyclical construction and mining segments.</p>
                        </div>
                        <div class="kpi-card bg-amber-50 border-amber-200 p-6 flex flex-col justify-center">
                            <p class="kpi-label">End Markets</p>
                            <p class="kpi-value text-amber-800 text-base">Oil & Gas, Power Gen, Marine, Rail, Industrial</p>
                            <p class="content-text text-sm mt-2">The diversity of end markets for its engines and turbines provides a source of stability for the overall business.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="financials" class="section-card scroll-mt-20">
            <h2 class="section-title">Financial Deep Dive</h2>
            <p class="content-text mb-6">As a premier industrial company, Caterpillar's financial performance is inherently cyclical and tied to the health of the global economy. After a strong period of growth fueled by infrastructure spending and high commodity prices, the company is now seeing demand moderate from its peak. The company's focus on operational excellence has allowed it to achieve record profit margins and generate substantial free cash flow, which it consistently returns to shareholders.</p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div>
                    <h3 class="subsection-title">Fiscal Year Trends (2020-2024)</h3>
                    <div class="mb-4">
                        <label for="yearlyMetricSelect" class="block text-sm font-medium text-gray-700 mb-1">Select Annual Metric:</label>
                        <select id="yearlyMetricSelect" class="block w-full p-2 border border-stone-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500">
                            <option value="netRevenue" selected>Total Revenue ($B)</option>
                            <option value="operatingProfit">Operating Profit ($B)</option>
                        </select>
                    </div>
                    <div id="yearlyFinancialChartContainer" class="chart-container h-80 max-w-full">
                        <canvas id="yearlyFinancialChart"></canvas>
                    </div>
                </div>

                <div>
                    <h3 class="subsection-title">Quarterly Segment Revenue ($B)</h3>
                     <div class="mb-4">
                        <label for="quarterlyMetricSelect" class="block text-sm font-medium text-gray-700 mb-1">View:</label>
                        <select id="quarterlyMetricSelect" class="block w-full p-2 border border-stone-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500">
                            <option value="segmentRevenue" selected>Revenue by Segment</option>
                        </select>
                    </div>
                    <div id="quarterlyFinancialChartContainer" class="chart-container h-80 max-w-full">
                        <canvas id="quarterlyFinancialChart"></canvas>
                    </div>
                </div>
            </div>
             <p class="content-text text-sm mt-6 text-center">The financial charts show the strong cyclical recovery from the 2020 lows to the peak in 2023. The quarterly view highlights the consistent, large contribution from the Construction Industries segment.</p>
        </section>

        <section id="competition" class="section-card scroll-mt-20">
            <h2 class="section-title">Competitive Moat: The Unmatched Dealer Network</h2>
            <p class="content-text mb-6">Caterpillar possesses one of the widest and most durable competitive moats in the industrial sector. This advantage is not just from making quality equipment, but from the powerful combination of its brand, its massive installed base, and its unparalleled global dealer network.</p>
            
            <div class="grid md:grid-cols-2 gap-8">
                <div>
                    <h3 class="subsection-title !mt-0">Key Moats</h3>
                    <ul class="list-none space-y-3">
                        <li class="flex items-start">
                            <span class="text-amber-800 mr-2 mt-1">‚ûî</span>
                            <span class="content-text"><strong class="text-gray-700">Unparalleled Dealer Network:</strong> This is Caterpillar's crown jewel. Its 160 independent dealers operate in 197 countries, providing a global sales, service, and support footprint that is virtually impossible for competitors to replicate. This network ensures high equipment uptime for customers, a critical factor in their purchasing decisions.</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-amber-800 mr-2 mt-1">‚ûî</span>
                            <span class="content-text"><strong class="text-gray-700">Massive Installed Base & Services Revenue:</strong> Millions of Caterpillar machines are in operation globally. This creates a massive, captive market for high-margin aftermarket parts and services, which are primarily sold through its dealer network. This provides a stable, recurring revenue stream that smooths out the cyclicality of machine sales.</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-amber-800 mr-2 mt-1">‚ûî</span>
                            <span class="content-text"><strong class="text-gray-700">Premium Brand & Reputation:</strong> The "Cat" brand is synonymous with high quality, durability, and reliability. This strong reputation allows Caterpillar to command premium pricing for its equipment compared to many of its competitors.</span>
                        </li>
                    </ul>
                </div>
                <div>
                    <h3 class="subsection-title !mt-0">Primary Competitors</h3>
                     <ul class="list-none space-y-3">
                        <li class="flex items-start">
                            <span class="text-amber-600 mr-2 mt-1">‚óè</span>
                            <span class="content-text"><strong class="text-gray-700">Komatsu:</strong> The primary global competitor, a major Japanese manufacturer with a broad portfolio of construction and mining equipment that competes head-to-head with Caterpillar.</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-amber-600 mr-2 mt-1">‚óè</span>
                            <span class="content-text"><strong class="text-gray-700">Deere & Company:</strong> A strong competitor, particularly in smaller and mid-sized construction equipment in North America.</span>
                        </li>
                         <li class="flex items-start">
                            <span class="text-amber-600 mr-2 mt-1">‚óè</span>
                             <span class="content-text"><strong class="text-gray-700">Other Industrial Manufacturers:</strong> Faces competition from other global players like Volvo Construction Equipment and Hitachi Construction Machinery.</span>
                        </li>
                    </ul>
                </div>
            </div>
        </section>

        <section id="outlook" class="section-card scroll-mt-20">
            <h2 class="section-title">Strategic Outlook: Risks & Rewards</h2>
            <p class="content-text mb-6">The investment thesis for Caterpillar is a bet on global economic growth and the long-term need for infrastructure, energy, and mined commodities. The rewards come from its dominant market position and strong shareholder returns, while the risks are inextricably linked to the health of the global economy.</p>
            <div class="grid md:grid-cols-2 gap-8">
                <div>
                    <h3 class="subsection-title !mt-0 text-teal-600">Rewards & Opportunities üöÄ</h3>
                    <ul class="list-disc list-inside content-text space-y-2 pl-4">
                        <li><strong>Secular Growth in Infrastructure:</strong> Long-term global trends like urbanization, decarbonization (requiring massive amounts of mined copper), and infrastructure upgrades provide a durable tailwind for equipment demand.</li>
                        <li><strong>Growing High-Margin Services Business:</strong> The strategic focus on growing services revenue should lead to more stable and predictable earnings and higher overall profitability.</li>
                        <li><strong>"Dividend Aristocrat" Status:</strong> As a company that has increased its dividend for over 30 consecutive years, Caterpillar offers a reliable and growing income stream for long-term investors.</li>
                        <li><strong>Market Leadership & Pricing Power:</strong> Its dominant market position and premium brand allow it to maintain strong pricing power, protecting margins during inflationary periods.</li>
                    </ul>
                </div>
                <div>
                    <h3 class="subsection-title !mt-0 text-orange-600">Risks & Challenges üìâ</h3>
                    <ul class="list-disc list-inside content-text space-y-2 pl-4">
                        <li><strong>High Sensitivity to Economic Cycles:</strong> This is the single biggest risk. Demand for Caterpillar's equipment is highly cyclical and would decline sharply in a global economic recession.</li>
                        <li><strong>Dependence on Commodity Prices:</strong> The Resource Industries segment is highly dependent on the capital spending of mining companies, which is driven by volatile commodity prices.</li>
                        <li><strong>Geopolitical & Trade Risks:</strong> As a major global exporter, the company is exposed to risks from international trade disputes, tariffs, and geopolitical instability.</li>
                        <li><strong>Execution of Services Strategy:</strong> While promising, the successful execution of its ambitious goal to double services revenue is a key challenge that requires significant investment and focus.</li>
                    </ul>
                </div>
            </div>
        </section>

        <footer class="bg-stone-800 text-stone-300 py-8 text-center mt-12">
            <p class="text-sm">&copy; <span id="currentYearFooter"></span> TickerHack Deep Research. For informational purposes only.</p>
            <p class="text-xs mt-1">Data synthesized from Caterpillar Inc. public filings and credible financial news sources as of June 2025.</p>
        </footer>

    <script>
        document.getElementById('currentYearFooter').textContent = new Date().getFullYear();

        // Mobile menu toggle
        const mobileMenuBtn = document.getElementById('mobile-menu-button');
        const mobileMenuEl = document.getElementById('mobile-menu');
        mobileMenuBtn.addEventListener('click', () => {
            mobileMenuEl.classList.toggle('hidden');
            mobileMenuBtn.querySelectorAll('svg').forEach(svg => svg.classList.toggle('hidden'));
        });
        
        // Smooth scroll and active nav link highlighting
        const navLinks = document.querySelectorAll('header nav a[href^="#"]');
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                if (!mobileMenuEl.classList.contains('hidden')) {
                    mobileMenuBtn.click(); // Close mobile menu if open
                }
                navLinks.forEach(l => l.classList.remove('active'));
                e.currentTarget.classList.add('active');
            });
        });
        
        // Segment Tabs
        const segmentTabs = document.querySelectorAll('.segment-tab-button');
        const segmentContents = document.querySelectorAll('.segment-content');
        segmentTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                segmentTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                const targetId = tab.dataset.target + 'Content';
                segmentContents.forEach(content => {
                    content.id === targetId ? content.classList.remove('hidden') : content.classList.add('hidden');
                });
            });
        });

        // Chart.js Global Config
        Chart.defaults.font.family = 'Inter, sans-serif';
        Chart.defaults.color = '#4B5563';

        const CHART_COLORS = {
            yellow: '#FBBF24',
            black: '#1F2937',
            red: '#DC2626',
            gray: '#6B7280'
        };

        // Segment Breakdown Chart (Doughnut)
        const segmentBreakdownCtx = document.getElementById('segmentBreakdownChart').getContext('2d');
        new Chart(segmentBreakdownCtx, {
            type: 'doughnut',
            data: {
                labels: ['Construction', 'Energy & Transportation', 'Resource Industries'],
                datasets: [{
                    label: 'FY2024 Revenue Mix',
                    data: [46, 33, 21], // Approximate revenue %
                    backgroundColor: [CHART_COLORS.yellow, CHART_COLORS.black, CHART_COLORS.red],
                    hoverOffset: 4
                }]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { position: 'bottom' }, title: { display: true, text: 'FY2024 Revenue Mix by Segment (%)' } }
            }
        });
        
        // --- FINANCIAL CHARTS LOGIC ---

        // Yearly Data Store
        const yearlyDataStore = {
            labels: ['FY20', 'FY21', 'FY22', 'FY23', 'FY24'],
            netRevenue: { data: [41.7, 51.0, 59.4, 67.1, 66.5], label: 'Total Revenue ($B)', color: CHART_COLORS.yellow },
            operatingProfit: { data: [4.2, 7.3, 8.0, 11.8, 11.5], label: 'Operating Profit ($B)', color: CHART_COLORS.black },
        };

        // Quarterly Data Store
        const quarterlyDataStore = {
            labels: ['Q2 23', 'Q3 23', 'Q4 23', 'Q1 24', 'Q2 24', 'Q3 24', 'Q4 24', 'Q1 25'],
            segmentRevenue: {
                datasets: [
                    {
                        label: 'Construction',
                        data: [7.2, 6.9, 6.6, 6.7, 7.0, 6.8, 6.5, 6.6],
                        backgroundColor: CHART_COLORS.yellow
                    },
                    {
                        label: 'Energy & Transportation',
                        data: [6.1, 6.2, 6.4, 6.3, 6.3, 6.4, 6.5, 6.4],
                        backgroundColor: CHART_COLORS.black
                    },
                     {
                        label: 'Resource Industries',
                        data: [3.4, 3.5, 3.3, 3.2, 3.3, 3.4, 3.2, 3.1],
                        backgroundColor: CHART_COLORS.red
                    }
                ]
            }
        };

        let yearlyChart = null;
        let quarterlyChart = null;
        const yearlySelect = document.getElementById('yearlyMetricSelect');
        const quarterlySelect = document.getElementById('quarterlyMetricSelect');
        const yearlyCanvas = document.getElementById('yearlyFinancialChart').getContext('2d');
        const quarterlyCanvas = document.getElementById('quarterlyFinancialChart').getContext('2d');

        function createYearlyChart(canvas, existingChart, dataStore, metricKey) {
            if (existingChart) {
                existingChart.destroy();
            }
            const metricDetails = dataStore[metricKey];
            return new Chart(canvas, {
                type: 'bar',
                data: {
                    labels: dataStore.labels,
                    datasets: [{
                        label: metricDetails.label,
                        data: metricDetails.data,
                        backgroundColor: metricDetails.color + 'BF',
                        borderColor: metricDetails.color,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { y: { beginAtZero: false, title: { display: true, text: metricDetails.label.split('(')[1].replace(')','')} } },
                    plugins: { legend: { display: false } }
                }
            });
        }

        function createQuarterlyChart(canvas, existingChart, dataStore, metricKey) {
            if (existingChart) {
                existingChart.destroy();
            }
            const metricDetails = dataStore[metricKey];
            return new Chart(canvas, {
                type: 'bar',
                data: {
                    labels: dataStore.labels,
                    datasets: metricDetails.datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { 
                        x: { stacked: true },
                        y: { stacked: true, title: { display: true, text: 'Revenue ($B)'} } 
                    },
                    plugins: { legend: { position: 'bottom' }, title: { display: true, text: 'Quarterly Revenue by Segment ($B)' } }
                }
            });
        }
        
        yearlySelect.addEventListener('change', (event) => {
            yearlyChart = createYearlyChart(yearlyCanvas, yearlyChart, yearlyDataStore, event.target.value);
        });

        quarterlySelect.addEventListener('change', (event) => {
            quarterlyChart = createQuarterlyChart(quarterlyCanvas, quarterlyChart, quarterlyDataStore, event.target.value);
        });

        // Initial chart renders
        yearlyChart = createYearlyChart(yearlyCanvas, yearlyChart, yearlyDataStore, 'netRevenue');
        quarterlyChart = createQuarterlyChart(quarterlyCanvas, quarterlyChart, quarterlyDataStore, 'segmentRevenue');

    </script>
</body>
</html>

