<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Starbucks Corp. (SBUX) - TickerHack Deep Research</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F5F5F4; /* stone-100 */
            color: #374151; /* gray-700 */
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 350px;
        }
        @media (min-width: 768px) { /* md */
            .chart-container {
                height: 350px;
                max-height: 400px;
            }
        }
        .section-card {
            background-color: #FFFFFF;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.07), 0 4px 6px -2px rgba(0, 0, 0, 0.04); /* Softer shadow */
            padding: 1.5rem; /* p-6 */
            margin-bottom: 2rem; /* mb-8 */
        }
        .main-title {
            font-size: 2.25rem; /* text-4xl */
            font-weight: 700; /* font-bold */
            color: #1F2937; /* gray-800 */
            margin-bottom: 1rem;
            text-align: center;
        }
        .section-title {
            font-size: 1.875rem; /* text-3xl */
            font-weight: 600; /* font-semibold */
            color: #166534; /* green-800 */
            margin-bottom: 1.5rem; /* mb-6 */
            padding-bottom: 0.5rem; /* pb-2 */
            border-bottom: 2px solid #E7E5E4; /* stone-200 */
        }
        .subsection-title {
            font-size: 1.5rem; /* text-2xl */
            font-weight: 600; /* font-semibold */
            color: #0d9488; /* teal-600 */
            margin-top: 1.5rem; /* mt-6 */
            margin-bottom: 1rem; /* mb-4 */
        }
        .content-text {
            line-height: 1.75;
            color: #4B5563; /* gray-600 */
            font-size: 0.95rem;
        }
        .highlight {
            color: #F97316; /* orange-500 */
            font-weight: 600;
        }
        .tab-button {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem; /* rounded-md */
            font-weight: 500;
            font-size: 0.875rem; /* text-sm */
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s;
            background-color: #E7E5E4; /* stone-200 */
            color: #374151; /* gray-700 */
            border: 1px solid transparent;
        }
        .tab-button.active {
            background-color: #166534; /* green-800 */
            color: #FFFFFF;
            border-color: #14532d; /* green-900 */
        }
        .nav-link {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem; /* rounded-md */
            font-weight: 500;
            color: #374151; /* gray-700 */
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
            white-space: nowrap;
        }
        .nav-link:hover, .nav-link.active {
            background-color: #166534; /* green-800 */
            color: #FFFFFF;
        }
        .kpi-card {
            background-color: #F9FAFB; /* gray-50 */
            border: 1px solid #E7E5E4; /* stone-200 */
            border-radius: 0.5rem; /* rounded-lg */
            padding: 1rem;
            text-align: center;
        }
        .kpi-label {
            font-size: 0.875rem; /* text-sm */
            color: #6B7280; /* gray-500 */
            margin-bottom: 0.25rem;
        }
        .kpi-value {
            font-size: 1.75rem; /* text-2xl or 3xl */
            font-weight: 600;
            color: #1F2937; /* gray-800 */
        }
    </style>
</head>
<body class="min-h-screen">

    <header class="sticky top-0 z-50 bg-white/95 backdrop-blur-md shadow-md">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex-shrink-0">
                    <h1 class="text-xl font-bold" style="color: #166534;">Starbucks (SBUX) Analysis</h1>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-1 lg:space-x-2">
                        <a href="#overview" class="nav-link">Overview</a>
                        <a href="#segments" class="nav-link">Business Model</a>
                        <a href="#financials" class="nav-link">Financials</a>
                        <a href="#competition" class="nav-link">Competitive Moat</a>
                        <a href="#outlook" class="nav-link">Outlook</a>
                    </div>
                </div>
                <div class="md:hidden">
                    <button id="mobile-menu-button" type="button" class="inline-flex items-center justify-center p-2 rounded-md text-gray-500 hover:text-gray-700 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-green-800" aria-controls="mobile-menu" aria-expanded="false">
                        <span class="sr-only">Open main menu</span>
                        <svg class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
                        <svg class="hidden h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
            </div>
            <div class="md:hidden hidden" id="mobile-menu">
                <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                    <a href="#overview" class="nav-link block text-base">Overview</a>
                    <a href="#segments" class="nav-link block text-base">Business Model</a>
                    <a href="#financials" class="nav-link block text-base">Financials</a>
                    <a href="#competition" class="nav-link block text-base">Competitive Moat</a>
                    <a href="#outlook" class="nav-link block text-base">Outlook</a>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mx-auto p-4 md:p-6 lg:p-8 mt-4">

        <section id="overview" class="section-card scroll-mt-20">
            <h2 class="section-title">Starbucks: Brewing a Turnaround</h2>
            <p class="content-text mb-6">Starbucks Corporation is the world's premier roaster, marketer, and retailer of specialty coffee. With over 38,000 stores globally, its brand is one of the most recognized and valuable in the world. The company operates through a mix of company-operated and licensed stores, selling coffee, teas, other beverages, and a variety of food items. After a period of slowing growth and operational challenges, Starbucks is in the midst of a significant strategic shift known as the <span class="highlight">"Triple Shot Reinvention Strategy."</span> This plan aims to address recent traffic declines and rising operational complexity by elevating the brand, strengthening its digital capabilities, and making its store operations more efficient to unlock long-term, sustainable growth.</p>
            
            <div class="grid md:grid-cols-2 gap-6 items-start">
                <div>
                    <h3 class="subsection-title !mt-0">Core Strategy: The "Triple Shot Reinvention"</h3>
                    <p class="content-text mb-4">Facing challenges from a complex menu and shifting consumer habits, Starbucks' strategy focuses on three key pillars:</p>
                    <ul class="list-disc list-inside content-text space-y-1 pl-4">
                        <li><strong class="font-semibold text-gray-700">Elevating the Brand:</strong> Improving the in-store experience through faster service and renovations, focusing on premium products, and accelerating its store opening plan, particularly for drive-thru and delivery-focused formats.</li>
                        <li><strong class="font-semibold text-gray-700">Strengthening Digital Engagement:</strong> Expanding the reach of its powerful Starbucks Rewards loyalty program, which already boasts over 75 million members globally, and using personalization to drive traffic and ticket growth.</li>
                        <li><strong class="font-semibold text-gray-700">Unlocking Efficiency:</strong> Investing over $3 billion to improve store operations, including rolling out new equipment (the "Siren System") to reduce drink preparation times, and optimizing supply chain and labor models to improve profitability.</li>
                    </ul>
                </div>
                <div class="kpi-card bg-green-50 border-green-200">
                    <p class="kpi-label">Global Rewards Members</p>
                    <p class="kpi-value text-green-800">75 Million+</p>
                    <p class="content-text text-sm mt-2">The massive and growing loyalty program is a cornerstone of Starbucks' digital moat, providing rich customer data and a direct channel to drive repeat business.</p>
                </div>
            </div>
        </section>

        <section id="segments" class="section-card scroll-mt-20">
            <h2 class="section-title">How Starbucks Makes Money: A Global Coffee Empire</h2>
            <p class="content-text mb-6">Starbucks' revenue is generated through two primary channels: company-operated stores, which provide the bulk of revenue and full margin capture, and licensed stores, which provide a high-margin stream of royalty and product sale revenue. This business is analyzed across two main geographic segments: North America and International.</p>

            <div class="mb-6 border-b border-stone-200">
                <nav class="-mb-px flex space-x-4" aria-label="Tabs">
                    <button class="segment-tab-button active" data-target="northAmerica">North America</button>
                    <button class="segment-tab-button" data-target="international">International</button>
                </nav>
            </div>

            <div id="segmentDetails">
                <div id="northAmericaContent" class="segment-content">
                    <h3 class="subsection-title">North America (~74% of Revenue)</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <p class="content-text mb-2">This is Starbucks' largest and most mature market, with the United States being the primary driver. Revenue is dominated by beverage sales, particularly customized cold drinks, which now account for over 60% of beverage revenue. The segment's performance is highly dependent on driving traffic from its massive base of loyalty members.</p>
                             <ul class="list-disc list-inside content-text space-y-1 pl-4 mt-4">
                                <li><strong>Key Drivers:</strong> Beverage innovation (cold foam, refreshers), food attachment, and morning peak traffic.</li>
                                <li><strong>Challenges:</strong> Recent declines in customer traffic, operational bottlenecks from complex custom orders, and a cautious consumer.</li>
                                <li><strong>Strategy:</strong> Focus on improving throughput with new equipment and store layouts, especially for drive-thru locations.</li>
                             </ul>
                        </div>
                        <div class="chart-container h-72 md:h-80">
                            <canvas id="revenueBreakdownChart"></canvas>
                        </div>
                    </div>
                </div>
                <div id="internationalContent" class="segment-content hidden">
                    <h3 class="subsection-title">International (~20% of Revenue)</h3>
                     <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                         <div>
                            <p class="content-text mb-2">The International segment is a key long-term growth engine, with China as its largest and most critical market. Starbucks operates over 7,000 stores in China and plans to reach 9,000 by 2025. This segment faces intense competition from local players and is more sensitive to macroeconomic conditions and geopolitical tensions.</p>
                            <ul class="list-disc list-inside content-text space-y-1 pl-4 mt-4">
                                <li><strong>Key Market:</strong> China is the second-largest market overall and the primary focus for new store growth.</li>
                                <li><strong>Challenges:</strong> A slower-than-expected recovery in China and intense price competition from local rivals like Luckin Coffee.</li>
                                <li><strong>Strategy:</strong> Emphasize premium positioning, expand digital engagement, and accelerate new store openings to build scale.</li>
                            </ul>
                        </div>
                        <div class="kpi-card bg-sky-50 border-sky-200">
                             <p class="kpi-label">Store Count in China (2025 Target)</p>
                             <p class="kpi-value text-sky-600">9,000</p>
                             <p class="content-text text-sm mt-2">Despite near-term challenges, Starbucks is committed to an aggressive expansion in China, viewing it as a critical component of its future growth.</p>
                         </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="financials" class="section-card scroll-mt-20">
            <h2 class="section-title">Financial Deep Dive</h2>
            <p class="content-text mb-6">Starbucks' financial performance has recently been under pressure, marked by slowing revenue growth and declining comparable store sales, particularly in its core U.S. market. While the company has historically been a model of consistent growth, it is now focused on executing its turnaround plan to reinvigorate sales and improve profitability in a challenging macroeconomic environment.</p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div>
                    <h3 class="subsection-title">Fiscal Year Trends (2021-2024)</h3>
                    <div class="mb-4">
                        <label for="yearlyMetricSelect" class="block text-sm font-medium text-gray-700 mb-1">Select Annual Metric:</label>
                        <select id="yearlyMetricSelect" class="block w-full p-2 border border-stone-300 rounded-md shadow-sm focus:ring-green-800 focus:border-green-800">
                            <option value="totalRevenue" selected>Total Revenue ($B)</option>
                            <option value="operatingIncome">Operating Income ($B)</option>
                            <option value="nonGaapEps">Non-GAAP EPS ($)</option>
                        </select>
                    </div>
                    <div id="yearlyFinancialChartContainer" class="chart-container h-80 max-w-full">
                        <canvas id="yearlyFinancialChart"></canvas>
                    </div>
                </div>

                <div>
                    <h3 class="subsection-title">Quarterly Trends (Recent 8 Qtrs)</h3>
                     <div class="mb-4">
                        <label for="quarterlyMetricSelect" class="block text-sm font-medium text-gray-700 mb-1">Select Quarterly Metric:</label>
                        <select id="quarterlyMetricSelect" class="block w-full p-2 border border-stone-300 rounded-md shadow-sm focus:ring-green-800 focus:border-green-800">
                             <option value="totalRevenue" selected>Total Revenue ($B)</option>
                             <option value="compSales">Comparable Store Sales Growth (%)</option>
                        </select>
                    </div>
                    <div id="quarterlyFinancialChartContainer" class="chart-container h-80 max-w-full">
                        <canvas id="quarterlyFinancialChart"></canvas>
                    </div>
                </div>
            </div>
             <p class="content-text text-sm mt-6 text-center">Financial charts reflect a period of post-pandemic recovery followed by recent softness in 2024, highlighting the urgency of the "Triple Shot Reinvention" strategy.</p>
        </section>

        <section id="competition" class="section-card scroll-mt-20">
            <h2 class="section-title">Competitive Moat: The Power of Brand and Habit</h2>
            <p class="content-text mb-6">Starbucks' competitive moat is built on two powerful pillars: an iconic global brand that commands premium pricing and a deeply entrenched digital ecosystem that fosters habitual consumer behavior. While the moat has been tested recently, its core strengths remain formidable.</p>
            
            <div class="grid md:grid-cols-2 gap-8">
                <div>
                    <h3 class="subsection-title !mt-0">Key Moats</h3>
                    <ul class="list-none space-y-3">
                        <li class="flex items-start">
                            <span class="text-green-700 mr-2 mt-1">➔</span>
                            <span class="content-text"><strong class="text-gray-700">Iconic Brand & Scale:</strong> The Starbucks brand is synonymous with coffee globally, allowing for premium pricing. Its massive scale provides significant purchasing power and operational leverage.</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-green-700 mr-2 mt-1">➔</span>
                            <span class="content-text"><strong class="text-gray-700">Digital Ecosystem & Loyalty Program:</strong> The Starbucks Rewards program is a best-in-class digital platform. It creates high switching costs by locking customers into its ecosystem and provides invaluable data for personalization and targeted marketing.</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-green-700 mr-2 mt-1">➔</span>
                            <span class="content-text"><strong class="text-gray-700">Habitual Consumption:</strong> For millions, a daily Starbucks visit is a deeply ingrained ritual. The convenience of its vast store network and mobile ordering system reinforces this habit.</span>
                        </li>
                         <li class="flex items-start">
                            <span class="text-green-700 mr-2 mt-1">➔</span>
                            <span class="content-text"><strong class="text-gray-700">Real Estate Portfolio:</strong> Decades of expertise have resulted in a portfolio of prime, high-traffic locations that are difficult for competitors to replicate.</span>
                        </li>
                    </ul>
                </div>
                <div>
                    <h3 class="subsection-title !mt-0">Primary Competitors</h3>
                     <ul class="list-none space-y-3">
                        <li class="flex items-start">
                            <span class="text-teal-600 mr-2 mt-1">●</span>
                            <span class="content-text"><strong class="text-gray-700">Specialty Coffee Shops:</strong> Chains like Dunkin' and Panera Bread, as well as a growing number of independent and third-wave coffee shops.</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-teal-600 mr-2 mt-1">●</span>
                            <span class="content-text"><strong class="text-gray-700">Quick-Service Restaurants (QSRs):</strong> Players like McDonald's and Wendy's have invested heavily in their coffee offerings, often at lower price points.</span>
                        </li>
                         <li class="flex items-start">
                            <span class="text-teal-600 mr-2 mt-1">●</span>
                            <span class="content-text"><strong class="text-gray-700">At-Home Coffee:</strong> High-quality home brewing systems from companies like Keurig Dr Pepper and Nespresso continue to gain popularity.</span>
                        </li>
                         <li class="flex items-start">
                            <span class="text-teal-600 mr-2 mt-1">●</span>
                            <span class="content-text"><strong class="text-gray-700">Local Competitors (China):</strong> In China, Starbucks faces aggressive competition from value-focused local players like Luckin Coffee and Cotti Coffee.</span>
                        </li>
                    </ul>
                </div>
            </div>
        </section>

        <section id="outlook" class="section-card scroll-mt-20">
            <h2 class="section-title">Strategic Outlook: Risks & Rewards</h2>
            <p class="content-text mb-6">Starbucks is at a critical juncture. The success of its "Reinvention" plan is paramount to restoring investor confidence and returning the company to a path of consistent growth. The rewards for successful execution are significant, but the near-term path is fraught with challenges.</p>
            <div class="grid md:grid-cols-2 gap-8">
                <div>
                    <h3 class="subsection-title !mt-0 text-emerald-600">Rewards & Opportunities 🚀</h3>
                    <ul class="list-disc list-inside content-text space-y-2 pl-4">
                        <li><strong>Successful Turnaround:</strong> If the "Triple Shot" strategy succeeds in improving store efficiency and re-engaging customers, there is significant upside for revenue and margin recovery.</li>
                        <li><strong>Powerful Brand Equity:</strong> The underlying power of the brand remains a major asset that can be leveraged to introduce new products and expand into new dayparts (e.g., afternoon and evening).</li>
                        <li><strong>Digital Leadership:</strong> The massive loyalty program provides a durable competitive advantage and a platform for future growth in digital ordering and payments.</li>
                        <li><strong>International Growth Runway:</strong> Despite current headwinds, the long-term opportunity for expansion in underpenetrated international markets, particularly in Asia, remains vast.</li>
                    </ul>
                </div>
                <div>
                    <h3 class="subsection-title !mt-0 text-orange-600">Risks & Challenges 📉</h3>
                    <ul class="list-disc list-inside content-text space-y-2 pl-4">
                        <li><strong>Execution Risk:</strong> The "Reinvention" plan is ambitious and complex. Failure to execute effectively on improving store throughput could lead to continued customer frustration and weak sales.</li>
                        <li><strong>Slowing Consumer Demand:</strong> A weakening global economy and more cautious consumer spending patterns pose a significant threat to traffic and sales, especially for a premium-priced product.</li>
                        <li><strong>Intense Competition:</strong> The coffee market is saturated with competitors at all price points, limiting Starbucks' pricing power and ability to gain market share.</li>
                        <li><strong>Labor & Cost Pressures:</strong> Ongoing unionization efforts and rising wages could continue to pressure margins. Volatility in coffee and dairy prices also presents a risk.</li>
                    </ul>
                </div>
            </div>
        </section>

        <footer class="bg-green-900 text-green-100 py-8 text-center mt-12">
            <p class="text-sm">&copy; <span id="currentYearFooter"></span> TickerHack Deep Research. For informational purposes only.</p>
            <p class="text-xs mt-1">Data synthesized from Starbucks Corp. public filings (SEC 10-K & 10-Q reports) and credible financial data providers as of June 2025.</p>
        </footer>

    <script>
        document.getElementById('currentYearFooter').textContent = new Date().getFullYear();

        // Mobile menu toggle
        const mobileMenuBtn = document.getElementById('mobile-menu-button');
        const mobileMenuEl = document.getElementById('mobile-menu');
        mobileMenuBtn.addEventListener('click', () => {
            mobileMenuEl.classList.toggle('hidden');
            mobileMenuBtn.querySelectorAll('svg').forEach(svg => svg.classList.toggle('hidden'));
        });
        
        // Smooth scroll and active nav link highlighting
        const navLinks = document.querySelectorAll('header nav a[href^="#"]');
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                if (mobileMenuEl && !mobileMenuEl.classList.contains('hidden')) {
                    mobileMenuBtn.click(); // Close mobile menu if open
                }
                navLinks.forEach(l => l.classList.remove('active'));
                e.currentTarget.classList.add('active');
            });
        });
        
        // Segment Tabs
        const segmentTabs = document.querySelectorAll('.segment-tab-button');
        const segmentContents = document.querySelectorAll('.segment-content');
        segmentTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                segmentTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                const targetId = tab.dataset.target + 'Content';
                segmentContents.forEach(content => {
                    content.id === targetId ? content.classList.remove('hidden') : content.classList.add('hidden');
                });
            });
        });

        // Chart.js Global Config
        Chart.defaults.font.family = 'Inter, sans-serif';
        Chart.defaults.color = '#4B5563';

        const CHART_COLORS = {
            green: '#166534',
            teal: '#0d9488',
            orange: '#FDBA74',
            stone: '#E7E5E4',
            gray: '#4B5563',
            darkGreen: '#14532d',
            lightGreen: '#6ee7b7'
        };

        // Revenue Breakdown Chart
        const revenueBreakdownCtx = document.getElementById('revenueBreakdownChart').getContext('2d');
        new Chart(revenueBreakdownCtx, {
            type: 'doughnut',
            data: {
                labels: ['North America', 'International', 'Channel Development'],
                datasets: [{
                    data: [74, 20, 6], // Approximate percentages
                    backgroundColor: [CHART_COLORS.green, CHART_COLORS.teal, CHART_COLORS.lightGreen],
                    hoverOffset: 4
                }]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { position: 'bottom' }, title: { display: true, text: 'Revenue by Segment (Approx. %)' } }
            }
        });

        // --- FINANCIAL CHARTS LOGIC ---

        // Yearly Data Store (Fiscal Years end ~Sep 30)
        const yearlyDataStore = {
            labels: ['FY21', 'FY22', 'FY23', 'FY24'],
            totalRevenue: { data: [29.06, 32.25, 35.98, 36.21], label: 'Total Revenue ($B)', color: CHART_COLORS.green },
            operatingIncome: { data: [4.87, 4.49, 5.87, 4.67], label: 'Operating Income ($B)', color: CHART_COLORS.teal },
            nonGaapEps: { data: [3.24, 2.96, 3.74, 3.32], label: 'Non-GAAP EPS ($)', color: CHART_COLORS.lightGreen }
        };

        // Quarterly Data Store
        const quarterlyDataStore = {
            labels: ['Q3 23', 'Q4 23', 'Q1 24', 'Q2 24', 'Q3 24', 'Q4 24', 'Q1 25', 'Q2 25'],
            totalRevenue: { data: [9.17, 9.37, 9.43, 8.56, 9.20, 9.02, 9.23, 8.76], label: 'Total Revenue ($B)', color: CHART_COLORS.green },
            compSales: { data: [10, 8, 5, -4, 1, -1, 3, -3], label: 'Global Comp Sales Growth (%)', color: CHART_COLORS.orange }
        };

        let yearlyChart = null;
        let quarterlyChart = null;
        const yearlySelect = document.getElementById('yearlyMetricSelect');
        const quarterlySelect = document.getElementById('quarterlyMetricSelect');
        const yearlyCanvas = document.getElementById('yearlyFinancialChart').getContext('2d');
        const quarterlyCanvas = document.getElementById('quarterlyFinancialChart').getContext('2d');

        function createChart(canvas, existingChart, dataStore, metricKey) {
            if (existingChart) {
                existingChart.destroy();
            }
            const metricDetails = dataStore[metricKey];
            const isLineChart = metricKey === 'nonGaapEps' || metricKey === 'compSales';

            return new Chart(canvas, {
                type: 'bar',
                data: {
                    labels: dataStore.labels,
                    datasets: [{
                        label: metricDetails.label,
                        data: metricDetails.data,
                        backgroundColor: isLineChart ? 'transparent' : metricDetails.color + 'BF',
                        borderColor: metricDetails.color,
                        borderWidth: 2,
                        type: isLineChart ? 'line' : 'bar',
                        fill: !isLineChart,
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { 
                        y: { 
                            beginAtZero: true, 
                            title: { display: true, text: metricDetails.label.split('(')[1].replace(')','') }
                        } 
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }
        
        yearlySelect.addEventListener('change', (event) => {
            yearlyChart = createChart(yearlyCanvas, yearlyChart, yearlyDataStore, event.target.value);
        });

        quarterlySelect.addEventListener('change', (event) => {
            quarterlyChart = createChart(quarterlyCanvas, quarterlyChart, quarterlyDataStore, event.target.value);
        });

        // Initial chart renders
        yearlyChart = createChart(yearlyCanvas, yearlyChart, yearlyDataStore, 'totalRevenue');
        quarterlyChart = createChart(quarterlyCanvas, quarterlyChart, quarterlyDataStore, 'totalRevenue');

    </script>
</body>
</html>

